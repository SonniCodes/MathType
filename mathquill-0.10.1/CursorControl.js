function getFocusedElement() { return $(".mq-focused").first() } function getFocusedMathFieldId() { return getFocusedElement().attr("id") } function getFocusedChildrenCount() { return $("#" + getFocusedMathFieldId().replace(/latex-math-field-/, "")).children().length } var id = 1; $(document).on("keydown", function (e) { var t = getFocusedElement(), n = $(":focus"), a = $(":input"), o = a.index(n); e.shiftKey || 13 !== e.keyCode || (e.preventDefault(), n = $('<math-field id="latex-math-field-' + id + '" class="math-content"></div>').insertAfter($(t)), MQ.MathField(n[0], { spaceBehavesLikeTab: !1, autoCommands: "pi theta sqrt sum int to Delta sigma null infinity lim Re Im linebreak oint binom", autoOperatorNames: "sin cos tan sec csc cot arcsin arccos arctan arccsc arcsec arccot sinh cosh tanh arcsinh arccosh arctanh log ln cis exp erf" }), $("#latex-math-field-" + id).children().filter("math-field").attr("id", id), (a = $(":input")).eq(o + 1).focus(), id += 1), !e.shiftKey && 8 === e.keyCode && "latex-math-field" !== $(t).attr("id") && getFocusedChildrenCount() <= 1 && (e.preventDefault(), e = getFocusedElement(), a.eq(o - 1).focus(), $(e).remove()) }), $(document).ready(function () { var a = !0; $(document).on("keydown keyup", function (e) { 16 === e.keyCode && (a = "keydown" !== e.type) }), $(document).on("keydown", function (e) { var t, n; $("span.mq-cursor").prev().hasClass("mq-large-operator") || $("span.mq-cursor").prev().hasClass("mq-supsub") || $("span.mq-cursor").parent().is("small") || $("span.mq-cursor").parent().is("span") || !a || 40 !== e.keyCode && 38 !== e.keyCode || (e.preventDefault(), n = $(":focus"), n = (t = $(":input")).index(n), 0 <= (n = 40 === e.keyCode ? n + 1 : n - 1) && n < t.length && t.eq(n).focus()) }) });