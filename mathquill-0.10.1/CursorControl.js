function getFocusedElement() { return $(".mq-focused").first() } function getFocusedMathFieldId() { return getFocusedElement().attr("id") } function getFocusedChildrenCount() { return $("#" + getFocusedMathFieldId().replace(/latex-math-field-/, "")).children().length } var id = 1; $(document).on("keydown", function (e) { var t = getFocusedElement(), n = $(":focus"), a = $(":input"), s = a.index(n); e.shiftKey || 13 !== e.keyCode || (e.preventDefault(), n = $('<math-field id="latex-math-field-' + id + '" class="math-content"></div>').insertAfter($(t)), MQ.MathField(n[0], { spaceBehavesLikeTab: !1, autoCommands: "pi theta sqrt sum int to Delta sigma null infinity lim Re Im linebreak oint binom", autoOperatorNames: "sin cos tan sec csc cot arcsin arccos arctan arccsc arcsec arccot sinh cosh tanh arcsinh arccosh arctanh log ln cis exp erf" }), $("#latex-math-field-" + id).children().filter("math-field").attr("id", id), (a = $(":input")).eq(s + 1).focus(), id += 1), e.shiftKey || 8 !== e.keyCode || "latex-math-field" === $(t).attr("id") || 1 != getFocusedChildrenCount() || (e.preventDefault(), e = getFocusedElement(), a.eq(s - 1).focus(), $(e).remove()) }), $(document).ready(function () { var e = !0; $(document).on("keydown keyup", function (t) { 16 === t.keyCode && (e = "keydown" !== t.type) }), $(document).on("keydown", function (t) { var n, a; $("span.mq-cursor").prev().hasClass("mq-large-operator") || $("span.mq-cursor").prev().hasClass("mq-supsub") || $("span.mq-cursor").parent().is("td") || $("span.mq-cursor").parent().is("small") || $("span.mq-cursor").parent().is("span") || !e || 40 !== t.keyCode && 38 !== t.keyCode || (t.preventDefault(), a = $(":focus"), a = (n = $(":input")).index(a), 0 <= (a = 40 === t.keyCode ? a + 1 : a - 1) && a < n.length && n.eq(a).focus()) }) });
