!function () { var t, e = window.jQuery, n = "mathquill-command-id", i = "mathquill-block-id", s = Math.min, r = Math.max; function a() { } var o = [].slice; function l(t) { var e = t.length - 1; return function () { var n = o.call(arguments, 0, e), i = o.call(arguments, e); return t.apply(this, n.concat([i])) } } var c = l((function (t, e) { return l((function (n, i) { if (t in n) return n[t].apply(n, e.concat(i)) })) })); function h(t) { return l((function (e, n) { return "function" != typeof e && (e = c(e)), t.call(this, (function (t) { return e.apply(t, [t].concat(n)) })) })) } function u(t) { var e = o.call(arguments, 1); return function () { return t.apply(this, e) } } function f(t, e) { if (!e) throw Error("prayer failed: " + t) } var p, d, m = (p = "prototype", d = {}.hasOwnProperty, function t(e, n) { function i() { var t = new s; return v(t.init) && t.init.apply(t, arguments), t } function s() { } void 0 === n && (n = e, e = Object), i.Bare = s; var r, a = b[p] = e[p], o = s[p] = i[p] = i.p = new b; return (o.constructor = i).mixin = function (e) { return s[p] = i[p] = t(i, e)[p], i }, (i.open = function (t) { if (r = {}, v(t) ? r = t.call(i, o, a, i, e) : g(t) && (r = t), g(r)) for (var n in r) d.call(r, n) && (o[n] = r[n]); return v(o.init) || (o.init = e), i })(n) }); function g(t) { return "object" == typeof t } function v(t) { return "function" == typeof t } function b() { } var w = -1; function x(t) { f("a direction was passed", t === w || 1 === t) } var q = m(e, (function (t) { t.insDirOf = function (t, e) { return t === w ? this.insertBefore(e.first()) : this.insertAfter(e.last()) }, t.insAtDirEnd = function (t, e) { return t === w ? this.prependTo(e) : this.appendTo(e) } })), y = m((function (t) { t.parent = 0, t[w] = 0, t[1] = 0, t.init = function (t, e, n) { this.parent = t, this[w] = e, this[1] = n }, this.copy = function (t) { return y(t.parent, t[w], t[1]) } })), O = m((function (t) { t[w] = 0, t[1] = 0; var e = t.parent = 0; this.byId = {}, t.init = function () { this.id = e += 1, (O.byId[this.id] = this).ends = {}, this.ends[w] = 0, this.ends[1] = 0 }, t.dispose = function () { delete O.byId[this.id] }, t.toString = function () { return "{{ MathQuill Node #" + this.id + " }}" }, t.jQ = q(), t.jQadd = function (t) { return this.jQ = this.jQ.add(t) }, t.jQize = function (t) { t = q(t || this.html()); for (var e = 0; e < t.length; e += 1)!function t(e) { var n, i; for (e.getAttribute && (n = e.getAttribute("mathquill-command-id"), i = e.getAttribute("mathquill-block-id"), n && O.byId[n].jQadd(e), i && O.byId[i].jQadd(e)), e = e.firstChild; e; e = e.nextSibling)t(e) }(t[e]); return t }, t.createDir = function (t, e) { return x(t), this.jQize(), this.jQ.insDirOf(t, e.jQ), e[t] = this.adopt(e.parent, e[w], e[1]), this }, t.createLeftOf = function (t) { return this.createDir(w, t) }, t.selectChildren = function (t, e) { return _(t, e) }, t.bubble = h((function (t) { for (var e = this; e && !1 !== t(e); e = e.parent); return this })), t.postOrder = h((function (t) { return function e(n) { n.eachChild(e), t(n) }(this), this })), t.isEmpty = function () { return 0 === this.ends[w] && 0 === this.ends[1] }, t.children = function () { return j(this.ends[w], this.ends[1]) }, t.eachChild = function () { var t = this.children(); return t.each.apply(t, arguments), this }, t.foldChildren = function (t, e) { return this.children().fold(t, e) }, t.withDirAdopt = function (t, e, n, i) { return j(this, this).withDirAdopt(t, e, n, i), this }, t.adopt = function (t, e, n) { return j(this, this).adopt(t, e, n), this }, t.disown = function () { return j(this, this).disown(), this }, t.remove = function () { return this.jQ.remove(), this.postOrder("dispose"), this.disown() } })); function k(t, e, n) { f("a parent is always present", t), f("leftward is properly set up", e ? e[1] === n && e.parent === t : t.ends[w] === n), f("rightward is properly set up", n ? n[w] === e && n.parent === t : t.ends[1] === e) } var j = m((function (e) { e.init = function (e, n, i) { i === t && (i = w), x(i), f("no half-empty fragments", !e == !n), this.ends = {}, e && (f("withDir is passed to Fragment", e instanceof O), f("oppDir is passed to Fragment", n instanceof O), f("withDir and oppDir have the same parent", e.parent === n.parent), this.ends[i] = e, this.ends[-i] = n, n = this.fold([], (function (t, e) { return t.push.apply(t, e.jQ.get()), t })), this.jQ = this.jQ.add(n)) }, e.jQ = q(), e.withDirAdopt = function (t, e, n, i) { return t === w ? this.adopt(e, n, i) : this.adopt(e, i, n) }, e.adopt = function (t, e, n) { k(t, e, n); var i = this; i.disowned = !1; var s = i.ends[w]; if (!s) return this; var r = i.ends[1]; return e || (t.ends[w] = s), n ? n[w] = r : t.ends[1] = r, i.ends[1][1] = n, i.each((function (n) { n[w] = e, n.parent = t, e && (e[1] = n), e = n })), i }, e.disown = function () { var t = this, e = t.ends[w]; if (!e || t.disowned) return t; t.disowned = !0; var n = t.ends[1], i = e.parent; return k(i, e[w], e), k(i, n, n[1]), e[w] ? e[w][1] = n[1] : i.ends[w] = n[1], n[1] ? n[1][w] = e[w] : i.ends[1] = e[w], t }, e.remove = function () { return this.jQ.remove(), this.each("postOrder", "dispose"), this.disown() }, e.each = h((function (t) { var e = this.ends[w]; if (!e) return this; for (; e !== this.ends[1][1] && !1 !== t(e); e = e[1]); return this })), e.fold = function (t, e) { return this.each((function (n) { t = e.call(this, t, n) })), t } })), C = {}, T = {}, Q = m(y, (function (t) { t.init = function (t, e) { this.parent = t, this.options = e; var n = this.jQ = this._jQ = q('<span class="mq-cursor">&#8203;</span>'); this.blink = function () { n.toggleClass("mq-blink") }, this.upDownCache = {} }, t.show = function () { return this.jQ = this._jQ.removeClass("mq-blink"), "intervalId" in this ? clearInterval(this.intervalId) : (this[1] ? this.selection && this.selection.ends[w][w] === this[w] ? this.jQ.insertBefore(this.selection.jQ) : this.jQ.insertBefore(this[1].jQ.first()) : this.jQ.appendTo(this.parent.jQ), this.parent.focus()), this.intervalId = setInterval(this.blink, 500), this }, t.hide = function () { return "intervalId" in this && clearInterval(this.intervalId), delete this.intervalId, this.jQ.detach(), this.jQ = q(), this }, t.withDirInsertAt = function (t, e, n, i) { var s = this.parent; this.parent = e, this[t] = n, this[-t] = i, s !== e && s.blur && s.blur() }, t.insDirOf = function (t, e) { return x(t), this.jQ.insDirOf(t, e.jQ), this.withDirInsertAt(t, e.parent, e[t], e), this.parent.jQ.addClass("mq-hasCursor"), this }, t.insLeftOf = function (t) { return this.insDirOf(w, t) }, t.insRightOf = function (t) { return this.insDirOf(1, t) }, t.insAtDirEnd = function (t, e) { return x(t), this.jQ.insAtDirEnd(t, e.jQ), this.withDirInsertAt(t, e, 0, e.ends[t]), e.focus(), this }, t.insAtLeftEnd = function (t) { return this.insAtDirEnd(w, t) }, t.insAtRightEnd = function (t) { return this.insAtDirEnd(1, t) }, t.jumpUpDown = function (t, e) { var n = this; n.upDownCache[t.id] = y.copy(n), (t = n.upDownCache[e.id]) ? t[1] ? n.insLeftOf(t[1]) : n.insAtRightEnd(t.parent) : (t = n.offset().left, e.seek(t, n)) }, t.offset = function () { var t = this.jQ.removeClass("mq-cursor").offset(); return this.jQ.addClass("mq-cursor"), t }, t.unwrapGramp = function () { var t = this.parent.parent, e = t.parent, n = t[1], i = t[w]; if (t.disown().eachChild((function (s) { s.isEmpty() || (s.children().adopt(e, i, n).each((function (e) { e.jQ.insertBefore(t.jQ.first()) })), i = s.ends[1]) })), !this[1]) if (this[w]) this[1] = this[w][1]; else for (; !this[1];) { if (this.parent = this.parent[1], !this.parent) { this[1] = t[1], this.parent = e; break } this[1] = this.parent.ends[w] } this[1] ? this.insLeftOf(this[1]) : this.insAtRightEnd(e), t.jQ.remove(), t[w].siblingDeleted && t[w].siblingDeleted(this.options, 1), t[1].siblingDeleted && t[1].siblingDeleted(this.options, w) }, t.startSelection = function () { for (var t = this.anticursor = y.copy(this), e = t.ancestors = {}, n = t; n.parent; n = n.parent)e[n.parent.id] = n }, t.endSelection = function () { delete this.anticursor }, t.select = function () { var t = this.anticursor; if (this[w] === t[w] && this.parent === t.parent) return !1; for (var e = this; e.parent; e = e.parent)if (e.parent.id in t.ancestors) { var n = e.parent; break } f("cursor and anticursor in the same tree", n); var i, s, r = t.ancestors[n.id], a = 1; if (e[w] !== r) for (var o = e; o; o = o[1])if (o[1] === r[1]) { a = w, i = e, s = r; break } return 1 === a && (i = r, s = e), i instanceof y && (i = i[1]), s instanceof y && (s = s[w]), this.hide().selection = n.selectChildren(i, s), this.insDirOf(a, this.selection.ends[a]), this.selectionChanged(), !0 }, t.clearSelection = function () { return this.selection && (this.selection.clear(), delete this.selection, this.selectionChanged()), this }, t.deleteSelection = function () { this.selection && (this[w] = this.selection.ends[w][w], this[1] = this.selection.ends[1][1], this.selection.remove(), this.selectionChanged(), delete this.selection) }, t.replaceSelection = function () { var t = this.selection; return t && (this[w] = t.ends[w][w], this[1] = t.ends[1][1], delete this.selection), t } })), _ = m(j, (function (t, e) { t.init = function () { e.init.apply(this, arguments), this.jQ = this.jQ.wrapAll('<span class="mq-selection"></span>').parent() }, t.adopt = function () { return this.jQ.replaceWith(this.jQ = this.jQ.children()), e.adopt.apply(this, arguments) }, t.clear = function () { return this.jQ.replaceWith(this.jQ[0].childNodes), this }, t.join = function (t) { return this.fold("", (function (e, n) { return e + n[t]() })) } })), S = m((function (t) { t.init = function (t, e, n) { this.id = t.id, this.data = {}, this.root = t, this.container = e, this.options = n, (t.controller = this).cursor = t.cursor = Q(t, n) }, t.handle = function (t, e) { var n, i = this.options.handlers; i && i.fns[t] && (n = i.APIClasses[this.KIND_OF_MQ](this), e === w || 1 === e ? i.fns[t](e, n) : i.fns[t](n)) }; var e = []; this.onNotify = function (t) { e.push(t) }, t.notify = function () { for (var t = 0; t < e.length; t += 1)e[t].apply(this.cursor, arguments); return this } })), D = {}, L = m(), E = {}, A = m(), R = {}; function I() { window.console } function z(t) { return I(), Ft(t) } z.prototype = A.p, z.interfaceVersion = function (t) { if (1 !== t) throw "Only interface version 1 supported. You specified: " + t; return (I = function () { window.console })(), z }; var B = (z.getInterface = F).MIN = 1, M = F.MAX = 2; function F(t) { if (!(B <= t && t <= M)) throw "Only interface versions between " + B + " and " + M + " supported. You specified: " + t; function e(t) { return t && t.nodeType && (t = (t = q(t).children(".mq-root-block").attr(i)) && O.byId[t].controller) ? n[t.KIND_OF_MQ](t) : null } var n = {}; function s(t, e) { for (var i in e && e.handlers && (e.handlers = { fns: e.handlers, APIClasses: n }), e) { var s, r; e.hasOwnProperty(i) && (s = e[i], r = E[i], t[i] = r ? r(s) : s) } } e.L = w, e.R = 1, e.config = function (t) { return s(L.p, t), this }, e.registerEmbed = function (t, e) { if (!/^[a-z][a-z0-9]*$/i.test(t)) throw "Embed name must start with letter and be only letters and digits"; R[t] = e }; var r, o = n.AbstractMathQuill = m(A, (function (t) { t.init = function (t) { this.__controller = t, this.__options = t.options, this.id = t.id, this.data = t.data }, t.__mathquillify = function (t) { var e = this.__controller, n = e.root, s = e.container; e.createTextarea(); var r = s.addClass(t).contents().detach(); n.jQ = q('<span class="mq-root-block"/>').attr(i, n.id).appendTo(s), this.latex(r.text()), this.revert = function () { return s.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(r) } }, t.config = function (t) { return s(this.__options, t), this }, t.el = function () { return this.__controller.container[0] }, t.text = function () { return this.__controller.exportText() }, t.latex = function (t) { return 0 < arguments.length ? (this.__controller.renderLatexMath(t), this.__controller.blurred && this.__controller.cursor.hide().parent.blur(), this) : this.__controller.exportLatex() }, t.html = function () { return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g, "").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i, "").replace(/ mq-hasCursor|mq-hasCursor ?/, "").replace(/ class=(""|(?= |>))/g, "") }, t.reflow = function () { return this.__controller.root.postOrder("reflow"), this } })); for (r in e.prototype = o.prototype, n.EditableField = m(o, (function (t, e) { t.__mathquillify = function () { return e.__mathquillify.apply(this, arguments), this.__controller.editable = !0, this.__controller.delegateMouseEvents(), this.__controller.editablesTextareaEvents(), this }, t.focus = function () { return this.__controller.textarea.focus(), this }, t.blur = function () { return this.__controller.textarea.blur(), this }, t.write = function (t) { return this.__controller.writeLatex(t), this.__controller.scrollHoriz(), this.__controller.blurred && this.__controller.cursor.hide().parent.blur(), this }, t.cmd = function (t) { var e, n = this.__controller.notify(), i = n.cursor; return /^\\[a-z]+$/i.test(t) ? (e = C[t = t.slice(1)]) && (t = e(t), i.selection && t.replaces(i.replaceSelection()), t.createLeftOf(i.show()), this.__controller.scrollHoriz()) : i.parent.write(i, t), n.blurred && i.hide().parent.blur(), this }, t.select = function () { var t = this.__controller; for (t.notify("move").cursor.insAtRightEnd(t.root); t.cursor[w];)t.selectLeft(); return this }, t.clearSelection = function () { return this.__controller.cursor.clearSelection(), this }, t.moveToDirEnd = function (t) { return this.__controller.notify("move").cursor.insAtDirEnd(t, this.__controller.root), this }, t.moveToLeftEnd = function () { return this.moveToDirEnd(w) }, t.moveToRightEnd = function () { return this.moveToDirEnd(1) }, t.keystroke = function (t) { t = t.replace(/^\s+|\s+$/g, "").split(/\s+/); for (var e = 0; e < t.length; e += 1)this.__controller.keystroke(t[e], { preventDefault: a }); return this }, t.typedText = function (t) { for (var e = 0; e < t.length; e += 1)this.__controller.typedText(t.charAt(e)); return this }, t.dropEmbedded = function (t, e, n) { var i = t - q(window).scrollLeft(), s = e - q(window).scrollTop(); s = document.elementFromPoint(i, s); this.__controller.seek(q(s), t, e), Mt().setOptions(n).createLeftOf(this.__controller.cursor) } })), (e.EditableField = function () { throw "wtf don't call me, I'm 'abstract'" }).prototype = n.EditableField.prototype, D) !function (i, s) { var r = n[i] = s(n); (e[i] = function (n, s) { var a = e(n); return a instanceof r || !n || !n.nodeType ? a : ((n = S(r.RootBlock(), q(n), L())).KIND_OF_MQ = i, r(n).__mathquillify(s, t)) }).prototype = r.prototype }(r, D[r]); return e } z.noConflict = function () { return window.MathQuill = N, z }; var N = window.MathQuill; function $(t) { for (var e = "moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" "), n = 0; n < e.length; n += 1)!function (e) { t[e] = function (t) { this.controller.handle(e, t) } }(e[n]); t.reflow = function () { this.controller.handle("reflow"), this.controller.handle("edited"), this.controller.handle("edit") } } window.MathQuill = z; var H, P = m((function (t, e, n) { function i(t, e) { throw "Parse Error: " + e + " at " + (t = t ? "'" + t + "'" : "EOF") } t.init = function (t) { this._ = t }, t.parse = function (t) { return this.skip(r)._("" + t, (function (t, e) { return e }), i) }, t.or = function (t) { f("or is passed a parser", t instanceof n); var e = this; return n((function (n, i, s) { return e._(n, i, (function (e) { return t._(n, i, s) })) })) }, t.then = function (t) { var e = this; return n((function (i, s, r) { return e._(i, (function (e, i) { return f("a parser is returned", (i = t instanceof n ? t : t(i)) instanceof n), i._(e, s, r) }), r) })) }, t.many = function () { var t = this; return n((function (e, n, i) { for (var s = []; t._(e, r, a);); return n(e, s); function r(t, n) { return e = t, s.push(n), !0 } function a() { return !1 } })) }, t.times = function (t, e) { arguments.length < 2 && (e = t); var i = this; return n((function (n, s, r) { for (var a, o = [], l = !0, c = 0; c < t; c += 1)if (!(l = i._(n, h, u))) return r(n, a); for (; c < e && l; c += 1)l = i._(n, h, f); return s(n, o); function h(t, e) { return o.push(e), n = t, !0 } function u(t, e) { return a = e, n = t, !1 } function f(t, e) { return !1 } })) }, t.result = function (t) { return this.then(s(t)) }, t.atMost = function (t) { return this.times(0, t) }, t.atLeast = function (t) { var e = this; return e.times(t).then((function (t) { return e.many().map((function (e) { return t.concat(e) })) })) }, t.map = function (t) { return this.then((function (e) { return s(t(e)) })) }, t.skip = function (t) { return this.then((function (e) { return t.result(e) })) }, this.string = function (t) { var e = t.length, i = "expected '" + t + "'"; return n((function (n, s, r) { var a = n.slice(0, e); return a === t ? s(n.slice(e), a) : r(n, i) })) }; t = this.regex = function (t) { f("regexp parser is anchored", "^" === t.toString().charAt(1)); var e = "expected " + t; return n((function (n, i, s) { var r = t.exec(n); return r ? (r = r[0], i(n.slice(r.length), r)) : s(n, e) })) }; var s = n.succeed = function (t) { return n((function (e, n) { return n(e, t) })) }, r = (n.fail = function (t) { return n((function (e, n, i) { return i(e, t) })) }, n.letter = t(/^[a-z]/i), n.letters = t(/^[a-z]*/i), n.digit = t(/^[0-9]/), n.digits = t(/^[0-9]*/), n.whitespace = t(/^\s+/), n.optWhitespace = t(/^\s*/), n.any = n((function (t, e, n) { return t ? e(t.slice(1), t.charAt(0)) : n(t, "expected any character") })), n.all = n((function (t, e, n) { return e("", t) })), n.eof = n((function (t, e, n) { return t ? n(t, "expected EOF") : e(t, t) }))) })), W = (H = { 8: "Backspace", 9: "Tab", 10: "Enter", 13: "Enter", 16: "Shift", 17: "Control", 18: "Alt", 20: "CapsLock", 27: "Esc", 32: "Spacebar", 33: "PageUp", 34: "PageDown", 35: "End", 36: "Home", 37: "Left", 38: "Up", 39: "Right", 40: "Down", 45: "Insert", 46: "Del", 144: "NumLock" }, function (t, n) { var i, s = null, r = null, o = e(t), l = (t = e(n.container || o), a); function c(t) { l = t, clearTimeout(i), i = setTimeout(t) } t.bind("keydown keypress input keyup focusout paste", (function (t) { l(t) })); var h = !1; function u() { var t, e, i, r; n.keystroke((i = H[e = (t = s).which || t.keyCode], r = [], t.ctrlKey && r.push("Ctrl"), t.originalEvent && t.originalEvent.metaKey && r.push("Meta"), t.altKey && r.push("Alt"), t.shiftKey && r.push("Shift"), e = i || String.fromCharCode(e), r.length || i ? (r.push(e), r.join("-")) : e), s) } function f() { var t; "selectionStart" in (t = o[0]) && t.selectionStart !== t.selectionEnd || (1 === (t = o.val()).length ? (o.val(""), n.typedText(t)) : t && o[0].select && o[0].select()) } function p() { var t = o.val(); o.val(""), t && n.paste(t) } return t.bind({ keydown: function (t) { s = t, r = null, h && c((function (t) { t && "focusout" === t.type || !o[0].select || o[0].select(), l = a, clearTimeout(i) })), u() }, keypress: function (t) { s && r && u(), r = t, c(f) }, focusout: function () { s = r = null }, paste: function (t) { o.focus(), c(p) } }), { select: function (t) { l(), l = a, clearTimeout(i), o.val(t), t && o[0].select && o[0].select(), h = !!t } } }); S.open((function (t, e) { t.exportText = function () { return this.root.foldChildren("", (function (t, e) { return t + e.text() })) } })), S.open((function (t) { t.focusBlurEvents = function () { var t, e = this, n = e.root, i = e.cursor; function s() { clearTimeout(t), i.selection && i.selection.jQ.addClass("mq-blur"), r() } function r() { i.hide().parent.blur(), e.container.removeClass("mq-focused"), q(window).off("blur", s) } e.textarea.focus((function () { e.blurred = !1, clearTimeout(t), e.container.addClass("mq-focused"), i.parent || i.insAtRightEnd(n), i.selection ? (i.selection.jQ.removeClass("mq-blur"), e.selectionChanged()) : i.show() })).blur((function () { e.blurred = !0, t = setTimeout((function () { n.postOrder("intentionalBlur"), i.clearSelection().endSelection(), r() })), q(window).on("blur", s) })), e.blurred = !0, i.hide().parent.blur() } })), S.open((function (t) { t.keystroke = function (t, e) { this.cursor.parent.keystroke(t, e, this) } })), O.open((function (t) { t.keystroke = function (t, e, n) { var i = n.cursor; switch (t) { case "Ctrl-Shift-Backspace": case "Ctrl-Backspace": n.ctrlDeleteDir(w); break; case "Shift-Backspace": case "Backspace": n.backspace(); break; case "Esc": case "Tab": return void n.escapeDir(1, t, e); case "Shift-Tab": case "Shift-Esc": return void n.escapeDir(w, t, e); case "End": n.notify("move").cursor.insAtRightEnd(i.parent); break; case "Ctrl-End": n.notify("move").cursor.insAtRightEnd(n.root); break; case "Shift-End": for (; i[1];)n.selectRight(); break; case "Ctrl-Shift-End": for (; i[1] || i.parent !== n.root;)n.selectRight(); break; case "Home": n.notify("move").cursor.insAtLeftEnd(i.parent); break; case "Ctrl-Home": n.notify("move").cursor.insAtLeftEnd(n.root); break; case "Shift-Home": for (; i[w];)n.selectLeft(); break; case "Ctrl-Shift-Home": for (; i[w] || i.parent !== n.root;)n.selectLeft(); break; case "Left": n.moveLeft(); break; case "Shift-Left": n.selectLeft(); break; case "Ctrl-Left": case "Ctrl-Right": break; case "Right": n.moveRight(); break; case "Shift-Right": n.selectRight(); break; case "Up": n.moveUp(); break; case "Down": n.moveDown(); break; case "Shift-Up": if (i[w]) for (; i[w];)n.selectLeft(); else n.selectLeft(); case "Shift-Down": if (i[1]) for (; i[1];)n.selectRight(); else n.selectRight(); case "Ctrl-Up": case "Ctrl-Down": break; case "Ctrl-Shift-Del": case "Ctrl-Del": n.ctrlDeleteDir(1); break; case "Shift-Del": case "Del": n.deleteForward(); break; case "Meta-A": case "Ctrl-A": for (n.notify("move").cursor.insAtRightEnd(n.root); i[w];)n.selectLeft(); break; default: return }e.preventDefault(), n.scrollHoriz() }, t.moveOutOf = t.moveTowards = t.deleteOutOf = t.deleteTowards = t.unselectInto = t.selectOutOf = t.selectTowards = function () { f("overridden or never called on this node") } })), S.open((function (t) { function e(t, e) { var n = t.notify("upDown").cursor, i = e + "Into", s = e + "OutOf"; return n[1][i] ? n.insAtLeftEnd(n[1][i]) : n[w][i] ? n.insAtRightEnd(n[w][i]) : n.parent.bubble((function (t) { var e = t[s]; if (e && ("function" == typeof e && (e = t[s](n)), e instanceof O && n.jumpUpDown(t, e), !0 !== e)) return !1 })), t } this.onNotify((function (t) { "move" !== t && "upDown" !== t || this.show().clearSelection() })), t.escapeDir = function (t, e, n) { x(t); var i = this.cursor; if (i.parent !== this.root && n.preventDefault(), i.parent !== this.root) return i.parent.moveOutOf(t, i), this.notify("move") }, E.leftRightIntoCmdGoes = function (t) { if (t && "up" !== t && "down" !== t) throw '"up" or "down" required for leftRightIntoCmdGoes option, got "' + t + '"'; return t }, t.moveDir = function (t) { x(t); var e = this.cursor, n = e.options.leftRightIntoCmdGoes; return e.selection ? e.insDirOf(t, e.selection.ends[t]) : e[t] ? e[t].moveTowards(t, e, n) : e.parent.moveOutOf(t, e, n), this.notify("move") }, t.moveLeft = function () { return this.moveDir(w) }, t.moveRight = function () { return this.moveDir(1) }, t.moveUp = function () { return e(this, "up") }, t.moveDown = function () { return e(this, "down") }, this.onNotify((function (t) { "upDown" !== t && (this.upDownCache = {}) })), this.onNotify((function (t) { "edit" === t && this.show().deleteSelection() })), t.deleteDir = function (t) { x(t); var e = this.cursor, n = e.selection; return this.notify("edit"), n || (e[t] ? e[t].deleteTowards(t, e) : e.parent.deleteOutOf(t, e)), e[w].siblingDeleted && e[w].siblingDeleted(e.options, 1), e[1].siblingDeleted && e[1].siblingDeleted(e.options, w), e.parent.bubble("reflow"), this }, t.ctrlDeleteDir = function (t) { return x(t), !(t = this.cursor)[w] || t.selection ? ctrlr.deleteDir() : (this.notify("edit"), j(t.parent.ends[w], t[w]).remove(), t.insAtDirEnd(w, t.parent), t[w].siblingDeleted && t[w].siblingDeleted(t.options, 1), t[1].siblingDeleted && t[1].siblingDeleted(t.options, w), t.parent.bubble("reflow"), this) }, t.backspace = function () { return this.deleteDir(w) }, t.deleteForward = function () { return this.deleteDir(1) }, this.onNotify((function (t) { "select" !== t && this.endSelection() })), t.selectDir = function (t) { var e = this.notify("select").cursor, n = e.selection; x(t), e.anticursor || e.startSelection(); var i = e[t]; i ? n && n.ends[t] === i && e.anticursor[-t] !== i ? i.unselectInto(t, e) : i.selectTowards(t, e) : e.parent.selectOutOf(t, e), e.clearSelection(), e.select() || e.show() }, t.selectLeft = function () { return this.selectDir(w) }, t.selectRight = function () { return this.selectDir(1) } })); var U, G, K, Z, X, Y, V = (qt = P.string, U = P.regex, G = P.letter, K = P.any, xt = P.optWhitespace, Z = P.succeed, X = P.fail, tt = G.map((function (t) { return dt(t) })), G = U(/^[^${}\\_^]/).map((function (t) { return it(t) })), tt = U(/^[^\\a-eg-zA-Z]/).or(qt("\\").then(U(/^[a-z]+/i).or(U(/^\s+/).result(" ")).or(K))).then((function (t) { var e = C[t]; return e ? e(t).parser() : X("unknown command: \\" + t) })).or(tt).or(G), G = qt("{").then((function () { return Y })).skip(qt("}")), Y = (tt = xt.then(G.or(tt.map((function (t) { var e = rt(); return t.adopt(e, 0, 0), e }))))).many().map(J).skip(xt), xt = qt("[").then(tt.then((function (t) { return "]" !== t.join("latex") ? Z(t) : X() })).many().map(J).skip(xt)).skip(qt("]")), (qt = Y).block = tt, qt.optBlock = xt, qt); function J(t) { for (var e = t[0] || rt(), n = 1; n < t.length; n += 1)t[n].children().adopt(e, e.ends[1], 0); return e } S.open((function (t, e) { t.exportLatex = function () { return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi, "$1") }, t.writeLatex = function (t) { var e = this.notify("edit").cursor, n = P.all, i = P.eof; return (t = V.skip(i).or(n.result(!1)).parse(t)) && !t.isEmpty() && (t.children().adopt(e.parent, e[w], e[1]), t.jQize().insertBefore(e.jQ), e[w] = t.ends[1], t.finalizeInsert(e.options, e), t.ends[1][1].siblingCreated && t.ends[1][1].siblingCreated(e.options, w), t.ends[w][w].siblingCreated && t.ends[w][w].siblingCreated(e.options, 1), e.parent.bubble("reflow")), this }, t.renderLatexMath = function (t) { var e = this.root, n = this.cursor, i = P.all, s = P.eof; i = V.skip(s).or(i.result(!1)).parse(t); e.eachChild("postOrder", "dispose"), e.ends[w] = e.ends[1] = 0, i && i.children().adopt(e, 0, 0), t = e.jQ, i ? (i = i.join("html"), t.html(i), e.jQize(t.children()), e.finalizeInsert(n.options)) : t.empty(), delete n.selection, n.insAtRightEnd(e) }, t.renderLatexText = function (t) { var e = this.root, n = this.cursor; e.jQ.children().slice(1).remove(), e.eachChild("postOrder", "dispose"), e.ends[w] = e.ends[1] = 0, delete n.selection, n.show().insAtRightEnd(e); var i = P.regex, s = P.string, r = P.eof, a = P.all, o = s("$").then(V).skip(s("$").or(r)).map((function (t) { var e = ht(n); e.createBlocks(); var i = e.ends[w]; return t.children().adopt(i, 0, 0), e })), l = (i = s("\\$").result("$").or(i(/^[^$]/)).map(it), o.or(i).many().skip(r).or(a.result(!1)).parse(t)); if (l) { for (var c = 0; c < l.length; c += 1)l[c].adopt(e, e.ends[1], 0); e.jQize().appendTo(e.jQ), e.finalizeInsert(n.options) } } })), S.open((function (e) { e.delegateMouseEvents = function () { var e = this.root.jQ; this.container.bind("mousedown.mathquill", (function (n) { var s, r = q(n.target).closest(".mq-root-block"), o = O.byId[r.attr(i) || e.attr(i)].controller, l = o.cursor, c = l.blink, h = o.textareaSpan, u = o.textarea; function f(t) { s = q(t.target) } function p(e) { l.anticursor || l.startSelection(), o.seek(s, e.pageX, e.pageY).cursor.select(), s = t } o.blurred && (o.editable || r.prepend(h), u.focus()), n.preventDefault(), n.target.unselectable = !0, l.blink = a, o.seek(q(n.target), n.pageX, n.pageY).cursor.startSelection(), r.mousemove(f), q(n.target.ownerDocument).mousemove(p).mouseup((function t(e) { l.blink = c, l.selection || (o.editable ? l.show() : h.detach()), r.unbind("mousemove", f), q(e.target.ownerDocument).unbind("mousemove", p).unbind("mouseup", t) })) })) } })), S.open((function (t) { t.seek = function (t, e, s) { var r = this.notify("select").cursor; t && ((a = t.attr(i) || t.attr(n)) || (a = (t = t.parent()).attr(i) || t.attr(n))); var a = a ? O.byId[a] : this.root; return f("nodeId is the id of some Node that exists", a), r.clearSelection().show(), a.seek(e, r), this.scrollHoriz(), this } })), S.open((function (t) { t.scrollHoriz = function () { var t = this.cursor, e = t.selection, n = this.root.jQ[0].getBoundingClientRect(); if (e) { var i = e.jQ[0].getBoundingClientRect(), s = i.left - (n.left + 20), r = i.right - (n.right - 20); if (e.ends[w] === t[1]) if (s < 0) var a = s; else { if (!(0 < r)) return; a = i.left - r < n.left + 20 ? s : r } else if (0 < r) a = r; else { if (!(s < 0)) return; a = i.right - s > n.right - 20 ? r : s } } else if ((t = t.jQ[0].getBoundingClientRect().left) > n.right - 20) a = t - (n.right - 20); else { if (!(t < n.left + 20)) return; a = t - (n.left + 20) } this.root.jQ.stop().animate({ scrollLeft: "+=" + a }, 100) } })), S.open((function (e) { L.p.substituteTextarea = function () { return q("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0] }, e.createTextarea = function () { var t = this.textareaSpan = q('<span class="mq-textarea"></span>'), e = this.options.substituteTextarea(); if (!e.nodeType) throw "substituteTextarea() must return a DOM element, got " + e; e = this.textarea = q(e).appendTo(t); var n = this; n.cursor.selectionChanged = function () { n.selectionChanged() }, n.container.bind("copy", (function () { n.setTextareaSelection() })) }, e.selectionChanged = function () { var e = this; Tt(e.container[0]), e.textareaSelectionTimeout === t && (e.textareaSelectionTimeout = setTimeout((function () { e.setTextareaSelection() }))) }, e.setTextareaSelection = function () { this.textareaSelectionTimeout = t; var e = ""; this.cursor.selection && (e = this.cursor.selection.join("latex"), this.options.statelessClipboard && (e = "$" + e + "$")), this.selectFn(e) }, e.staticMathTextareaEvents = function () { var t = this, e = (t.root, t.cursor), n = t.textarea, i = t.textareaSpan; function s() { i.detach(), t.blurred = !0 } this.container.prepend('<span class="mq-selectable">$' + t.exportLatex() + "$</span>"), t.blurred = !0, n.bind("cut paste", !1).focus((function () { t.blurred = !1 })).blur((function () { e.selection && e.selection.clear(), setTimeout(s) })), t.selectFn = function (t) { n.val(t), t && n.select() } }, e.editablesTextareaEvents = function () { var t = this, e = (t.root, t.cursor), n = t.textarea, i = t.textareaSpan, s = W(n, this); this.selectFn = function (t) { s.select(t) }, this.container.prepend(i).on("cut", (function (n) { e.selection && setTimeout((function () { t.notify("edit"), e.parent.bubble("reflow") })) })), this.focusBlurEvents() }, e.typedText = function (t) { if ("\n" === t) return this.handle("enter"); var e = this.notify().cursor; e.parent.write(e, t), this.scrollHoriz() }, e.paste = function (t) { this.options.statelessClipboard && (t = "$" === t.slice(0, 1) && "$" === t.slice(-1) ? t.slice(1, -1) : "\\text{" + t + "}"), this.writeLatex(t).cursor.show() } })); var tt = m(O, (function (t, e) { t.finalizeInsert = function (t, e) { this.postOrder("finalizeTree", t), this.postOrder("contactWeld", e), this.postOrder("blur"), this.postOrder("reflow"), this[1].siblingCreated && this[1].siblingCreated(t, w), this[w].siblingCreated && this[w].siblingCreated(t, 1), this.bubble("reflow") } })), et = m(tt, (function (t, e) { t.init = function (t, n, i) { var s = this; e.init.call(s), s.ctrlSeq || (s.ctrlSeq = t), n && (s.htmlTemplate = n), i && (s.textTemplate = i) }, t.replaces = function (t) { t.disown(), this.replacedFragment = t }, t.isEmpty = function () { return this.foldChildren(!0, (function (t, e) { return t && e.isEmpty() })) }, t.parser = function () { var t = V.block, e = this; return t.times(e.numBlocks()).map((function (t) { e.blocks = t; for (var n = 0; n < t.length; n += 1)t[n].adopt(e, e.ends[1], 0); return e })) }, t.createLeftOf = function (t) { var n = this.replacedFragment; this.createBlocks(), e.createLeftOf.call(this, t), n && (n.adopt(this.ends[w], 0, 0), n.jQ.appendTo(this.ends[w].jQ)), this.finalizeInsert(t.options), this.placeCursor(t) }, t.createBlocks = function () { for (var t = this.numBlocks(), e = this.blocks = Array(t), n = 0; n < t; n += 1)(e[n] = rt()).adopt(this, this.ends[1], 0) }, t.placeCursor = function (t) { t.insAtRightEnd(this.foldChildren(this.ends[w], (function (t, e) { return t.isEmpty() ? t : e }))) }, t.moveTowards = function (t, e, n) { n = n && this[n + "Into"], e.insAtDirEnd(-t, n || this.ends[-t]) }, t.deleteTowards = function (t, e) { this.isEmpty() ? e[t] = this.remove()[t] : this.moveTowards(t, e, null) }, t.selectTowards = function (t, e) { e[-t] = this, e[t] = this[t] }, t.selectChildren = function () { return _(this, this) }, t.unselectInto = function (t, e) { e.insAtDirEnd(-t, e.anticursor.ancestors[this.id]) }, t.seek = function (t, e) { function n(t) { var e = {}; return e[w] = t.jQ.offset().left, e[1] = e[w] + t.jQ.outerWidth(), e } var i = this, s = n(i); if (t < s[w]) return e.insLeftOf(i); if (t > s[1]) return e.insRightOf(i); var r = s[w]; i.eachChild((function (a) { var o = n(a); return t < o[w] ? (t - r < o[w] - t ? a[w] ? e.insAtRightEnd(a[w]) : e.insLeftOf(i) : e.insAtLeftEnd(a), !1) : t > o[1] ? void (a[1] ? r = o[1] : s[1] - t < t - o[1] ? e.insRightOf(i) : e.insAtRightEnd(a)) : (a.seek(t, e), !1) })) }, t.numBlocks = function () { var t = this.htmlTemplate.match(/&\d+/g); return t ? t.length : 0 }, t.html = function () { var t = this.blocks, e = " mathquill-command-id=" + this.id, n = this.htmlTemplate.match(/<[^<>]+>|[^<>]+/g); f("no unmatched angle brackets", n.join("") === this.htmlTemplate); for (var i = 0, s = n[0]; s; s = n[i += 1])if ("/>" === s.slice(-2)) n[i] = s.slice(0, -2) + e + "/>"; else if ("<" === s.charAt(0)) { f("not an unmatched top-level close tag", "/" !== s.charAt(1)), n[i] = s.slice(0, -1) + e + ">"; for (var r = 1; f("no missing close tags", s = n[i += 1]), "</" === s.slice(0, 2) ? --r : "<" === s.charAt(0) && "/>" !== s.slice(-2) && (r += 1), 0 < r;); } return n.join("").replace(/>&(\d+)/g, (function (e, n) { return " mathquill-block-id=" + t[n].id + ">" + t[n].join("html") })) }, t.latex = function () { return this.foldChildren(this.ctrlSeq, (function (t, e) { return t + "{" + (e.latex() || " ") + "}" })) }, t.textTemplate = [""], t.text = function () { var t = this, e = 0; return t.foldChildren(t.textTemplate[e], (function (n, i) { e += 1; var s = i.text(); return n && "(" === t.textTemplate[e] && "(" === s[0] && ")" === s.slice(-1) ? n + s.slice(1, -1) + t.textTemplate[e] : n + i.text() + (t.textTemplate[e] || "") })) } })), nt = m(et, (function (t, e) { t.init = function (t, n, i) { i = i || (t && 1 < t.length ? t.slice(1) : t), e.init.call(this, t, n, [i]) }, t.parser = function () { return P.succeed(this) }, t.numBlocks = function () { return 0 }, t.replaces = function (t) { t.remove() }, t.createBlocks = a, t.moveTowards = function (t, e) { e.jQ.insDirOf(t, this.jQ), e[-t] = this, e[t] = this[t] }, t.deleteTowards = function (t, e) { e[t] = this.remove()[t] }, t.seek = function (t, e) { t - this.jQ.offset().left < this.jQ.outerWidth() / 2 ? e.insLeftOf(this) : e.insRightOf(this) }, t.latex = function () { return this.ctrlSeq }, t.text = function () { return this.textTemplate }, t.placeCursor = a, t.isEmpty = function () { return !0 } })), it = m(nt, (function (t, e) { t.init = function (t, n) { e.init.call(this, t, "<span>" + (n || t) + "</span>") } })), st = m(nt, (function (t, e) { t.init = function (t, n, i) { e.init.call(this, t, '<span class="mq-binary-operator">' + n + "</span>", i) } })), rt = m(tt, (function (t, e) { t.join = function (t) { return this.foldChildren("", (function (e, n) { return e + n[t]() })) }, t.html = function () { return this.join("html") }, t.latex = function () { return this.join("latex") }, t.text = function () { return this.ends[w] === this.ends[1] && 0 !== this.ends[w] ? this.ends[w].text() : this.join("text") }, t.keystroke = function (t, n, i) { return !i.options.spaceBehavesLikeTab || "Spacebar" !== t && "Shift-Spacebar" !== t ? e.keystroke.apply(this, arguments) : (n.preventDefault(), void i.escapeDir("Shift-Spacebar" === t ? w : 1, t, n)) }, t.moveOutOf = function (t, e, n) { n && this.parent[n + "Into"] || !this[t] ? e.insDirOf(t, this.parent) : e.insAtDirEnd(-t, this[t]) }, t.selectOutOf = function (t, e) { e.insDirOf(t, this.parent) }, t.deleteOutOf = function (t, e) { e.unwrapGramp() }, t.seek = function (t, e) { var n = this.ends[1]; if (!n || n.jQ.offset().left + n.jQ.outerWidth() < t) return e.insAtRightEnd(this); if (t < this.ends[w].jQ.offset().left) return e.insAtLeftEnd(this); for (; t < n.jQ.offset().left;)n = n[w]; return n.seek(t, e) }, t.chToCmd = function (t) { var e; return (t.match(/^[a-eg-zA-Z]$/) ? dt : /^\d$/.test(t) ? ft : (e = T[t] || C[t]) ? e : it)(t) }, t.write = function (t, e) { e = this.chToCmd(e), t.selection && e.replaces(t.replaceSelection()), e.createLeftOf(t.show()) }, t.focus = function () { return this.jQ.addClass("mq-hasCursor"), this.jQ.removeClass("mq-empty"), this }, t.blur = function () { return this.jQ.removeClass("mq-hasCursor"), this.isEmpty() && this.jQ.addClass("mq-empty"), this } })); D.StaticMath = function (t) { return m(t.AbstractMathQuill, (function (e, n) { this.RootBlock = rt, e.__mathquillify = function () { return n.__mathquillify.call(this, "mq-math-mode"), this.__controller.delegateMouseEvents(), this.__controller.staticMathTextareaEvents(), this }, e.init = function () { n.init.apply(this, arguments), this.__controller.root.postOrder("registerInnerField", this.innerFields = [], t.MathField) }, e.latex = function () { var e = n.latex.apply(this, arguments); return 0 < arguments.length && this.__controller.root.postOrder("registerInnerField", this.innerFields = [], t.MathField), e } })) }; var at = m(rt, $); D.MathField = function (t) { return m(t.EditableField, (function (t, e) { this.RootBlock = at, t.__mathquillify = function (t, n) { return this.config(t), 1 < n && (this.__controller.root.reflow = a), e.__mathquillify.call(this, "mq-editable-field mq-math-mode"), delete this.__controller.root.reflow, this } })) }; var ot = m(O, (function (t, e) { function n(t) { t.jQ[0].normalize(); var e = t.jQ[0].firstChild; f("only node in TextBlock span is Text node", 3 === e.nodeType); var n = lt(e.data); return n.jQadd(e), t.children().disown(), n.adopt(t, 0, 0) } t.ctrlSeq = "\\text", t.replaces = function (t) { t instanceof j ? this.replacedText = t.remove().jQ.text() : "string" == typeof t && (this.replacedText = t) }, t.jQadd = function (t) { e.jQadd.call(this, t), this.ends[w] && this.ends[w].jQadd(this.jQ[0].firstChild) }, t.createLeftOf = function (t) { if (e.createLeftOf.call(this, t), this[1].siblingCreated && this[1].siblingCreated(t.options, w), this[w].siblingCreated && this[w].siblingCreated(t.options, 1), this.bubble("reflow"), t.insAtRightEnd(this), this.replacedText) for (var n = 0; n < this.replacedText.length; n += 1)this.write(t, this.replacedText.charAt(n)) }, t.parser = function () { var t = this, e = P.string, n = P.regex; return P.optWhitespace.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map((function (e) { return lt(e).adopt(t, 0, 0), t })) }, t.textContents = function () { return this.foldChildren("", (function (t, e) { return t + e.text })) }, t.text = function () { return '"' + this.textContents() + '"' }, t.latex = function () { return "\\text{" + this.textContents() + "}" }, t.html = function () { return '<span class="mq-text-mode" mathquill-command-id=' + this.id + ">" + this.textContents() + "</span>" }, t.moveTowards = function (t, e) { e.insAtDirEnd(-t, this) }, t.moveOutOf = function (t, e) { e.insDirOf(t, this) }, t.unselectInto = t.moveTowards, t.selectTowards = et.prototype.selectTowards, t.deleteTowards = et.prototype.deleteTowards, t.selectOutOf = function (t, e) { e.insDirOf(t, this) }, t.deleteOutOf = function (t, e) { this.isEmpty() && e.insRightOf(this) }, t.write = function (t, n) { var i; t.show().deleteSelection(), "$" !== n ? t[w] ? t[w].appendText(n) : lt(n).createLeftOf(t) : this.isEmpty() ? (t.insRightOf(this), it("\\$", "$").createLeftOf(t)) : t[1] ? t[w] ? (i = ot(), (n = this.ends[w]).disown(), n.adopt(i, 0, 0), t.insLeftOf(this), e.createLeftOf.call(i, t)) : t.insLeftOf(this) : t.insRightOf(this) }, t.seek = function (t, e) { e.hide(); var i = n(this), s = this.jQ.width() / this.text.length; (s = Math.round((t - this.jQ.offset().left) / s)) <= 0 ? e.insAtLeftEnd(this) : s >= i.text.length ? e.insAtRightEnd(this) : e.insLeftOf(i.splitRight(s)); for (var r, a = t - e.show().offset().left, o = a && a < 0 ? w : 1, l = o; e[o] && 0 < a * l;)e[o].moveTowards(o, e), l = a, a = t - e.offset().left; o * a < -o * l && e[-o].moveTowards(-o, e), e.anticursor ? e.anticursor.parent === this && (s = e[w] && e[w].text.length, this.anticursorPosition === s ? e.anticursor = y.copy(e) : (this.anticursorPosition < s ? (r = e[w].splitRight(this.anticursorPosition), e[w] = r) : r = e[1].splitRight(this.anticursorPosition - s), e.anticursor = y(this, r[w], r))) : this.anticursorPosition = e[w] && e[w].text.length }, t.blur = function () { rt.prototype.blur.call(this), n(this) }, t.focus = rt.prototype.focus })), lt = m(O, (function (t, e) { function n(t, e) { return e.charAt(t === w ? 0 : -1 + e.length) } t.init = function (t) { e.init.call(this), this.text = t }, t.jQadd = function (t) { this.dom = t, this.jQ = q(t) }, t.jQize = function () { return this.jQadd(document.createTextNode(this.text)) }, t.appendText = function (t) { this.text += t, this.dom.appendData(t) }, t.prependText = function (t) { this.text = t + this.text, this.dom.insertData(0, t) }, t.insTextAtDirEnd = function (t, e) { x(e), 1 === e ? this.appendText(t) : this.prependText(t) }, t.splitRight = function (t) { var e = lt(this.text.slice(t)).adopt(this.parent, this, this[1]); return e.jQadd(this.dom.splitText(t)), this.text = this.text.slice(0, t), e }, t.moveTowards = function (t, e) { x(t); var i = n(-t, this.text), s = this[-t]; return s ? s.insTextAtDirEnd(i, t) : lt(i).createDir(-t, e), this.deleteTowards(t, e) }, t.latex = function () { return this.text }, t.deleteTowards = function (t, e) { 1 < this.text.length ? 1 === t ? (this.dom.deleteData(0, 1), this.text = this.text.slice(1)) : (this.dom.deleteData(-1 + this.text.length, 1), this.text = this.text.slice(0, -1)) : (this.remove(), this.jQ.remove(), e[t] = this[t]) }, t.selectTowards = function (t, e) { x(t); var i, s, r = e.anticursor, a = n(-t, this.text); return r[t] === this ? (s = lt(a).createDir(t, e), r[t] = s, e.insDirOf(t, s)) : ((i = this[-t]) ? i.insTextAtDirEnd(a, t) : (s = lt(a).createDir(-t, e)).jQ.insDirOf(-t, e.selection.jQ), 1 === this.text.length && r[-t] === this && (r[-t] = this[-t])), this.deleteTowards(t, e) } })); function ct(t, e, n) { return m(ot, { ctrlSeq: t, htmlTemplate: "<" + e + " " + n + ">&0</" + e + ">" }) } T.$ = C.text = C.textnormal = C.textrm = C.textup = C.textmd = ot, C.em = C.italic = C.italics = C.emph = C.textit = C.textsl = ct("\\textit", "i", 'class="mq-text-mode"'), C.strong = C.bold = C.textbf = ct("\\textbf", "b", 'class="mq-text-mode"'), C.sf = C.textsf = ct("\\textsf", "span", 'class="mq-sans-serif mq-text-mode"'), C.tt = C.texttt = ct("\\texttt", "span", 'class="mq-monospace mq-text-mode"'), C.textsc = ct("\\textsc", "span", 'style="font-variant:small-caps" class="mq-text-mode"'), C.uppercase = ct("\\uppercase", "span", 'style="text-transform:uppercase" class="mq-text-mode"'), C.lowercase = ct("\\lowercase", "span", 'style="text-transform:lowercase" class="mq-text-mode"'); var ht = m(et, (function (t, e) { t.init = function (t) { e.init.call(this, "$"), this.cursor = t }, t.htmlTemplate = '<span class="mq-math-mode">&0</span>', t.createBlocks = function () { e.createBlocks.call(this), this.ends[w].cursor = this.cursor, this.ends[w].write = function (t, e) { "$" !== e ? rt.prototype.write.call(this, t, e) : this.isEmpty() ? (t.insRightOf(this.parent), this.parent.deleteTowards(dir, t), it("\\$", "$").createLeftOf(t.show())) : t[1] ? t[w] ? rt.prototype.write.call(this, t, e) : t.insLeftOf(this.parent) : t.insRightOf(this.parent) } }, t.latex = function () { return "$" + this.ends[w].latex() + "$" } })), ut = m(at, (function (t, e) { t.keystroke = function (t) { if ("Spacebar" !== t && "Shift-Spacebar" !== t) return e.keystroke.apply(this, arguments) }, t.write = function (t, e) { var n; t.show().deleteSelection(), "$" === e ? ht(t).createLeftOf(t) : ("<" === e ? n = "&lt;" : ">" === e && (n = "&gt;"), it(e, n).createLeftOf(t)) } })); D.TextField = function (t) { return m(t.EditableField, (function (t, e) { this.RootBlock = ut, t.__mathquillify = function () { return e.__mathquillify.call(this, "mq-editable-field mq-text-mode") }, t.latex = function (t) { return 0 < arguments.length ? (this.__controller.renderLatexText(t), this.__controller.blurred && this.__controller.cursor.hide().parent.blur(), this) : this.__controller.exportLatex() } })) }, T["\\"] = m(et, (function (t, e) { t.ctrlSeq = "\\", t.replaces = function (t) { this._replacedFragment = t.disown(), this.isEmpty = function () { return !1 } }, t.htmlTemplate = '<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>', t.textTemplate = ["\\"], t.createBlocks = function () { e.createBlocks.call(this), this.ends[w].focus = function () { return this.parent.jQ.addClass("mq-hasCursor"), this.isEmpty() && this.parent.jQ.removeClass("mq-empty"), this }, this.ends[w].blur = function () { return this.parent.jQ.removeClass("mq-hasCursor"), this.isEmpty() && this.parent.jQ.addClass("mq-empty"), this }, this.ends[w].write = function (t, e) { t.show().deleteSelection(), e.match(/[a-z]/i) ? it(e).createLeftOf(t) : (this.parent.renderCommand(t), "\\" === e && this.isEmpty() || this.parent.parent.write(t, e)) }, this.ends[w].keystroke = function (t, n, i) { return "Tab" === t || "Enter" === t || "Spacebar" === t ? (this.parent.renderCommand(i.cursor), void n.preventDefault()) : e.keystroke.apply(this, arguments) } }, t.createLeftOf = function (t) { var n; e.createLeftOf.call(this, t), this._replacedFragment && (n = this.jQ[0], this.jQ = this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove", (function (t) { return q(t.target = n).trigger(t), !1 })).insertBefore(this.jQ).add(this.jQ)) }, t.latex = function () { return "\\" + this.ends[w].latex() + " " }, t.renderCommand = function (t) { this.jQ = this.jQ.last(), this.remove(), this[1] ? t.insLeftOf(this[1]) : t.insAtRightEnd(this.parent); var e = this.ends[w].latex(), n = C[e = e || " "]; n ? (n = n(e), this._replacedFragment && n.replaces(this._replacedFragment), n.createLeftOf(t)) : ((n = ot()).replaces(e), n.createLeftOf(t), t.insRightOf(n), this._replacedFragment && this._replacedFragment.remove()) } })), C.notin = C.cong = C.equiv = C.oplus = C.otimes = m(st, (function (t, e) { t.init = function (t) { e.init.call(this, "\\" + t + " ", "&" + t + ";") } })), C["≠"] = C.ne = C.neq = u(st, "\\ne ", "&ne;"), C.ast = C.star = C.loast = C.lowast = u(st, "\\ast ", "&lowast;"), C.therefor = C.therefore = u(st, "\\therefore ", "&there4;"), C.cuz = C.because = u(st, "\\because ", "&#8757;"), C.prop = C.propto = u(st, "\\propto ", "&prop;"), C["≈"] = C.asymp = C.approx = u(st, "\\approx ", "&asymp;"), C.isin = C.in = u(st, "\\in ", "&isin;"), C.ni = C.contains = u(st, "\\ni ", "&ni;"), C.notni = C.niton = C.notcontains = C.doesnotcontain = u(st, "\\not\\ni ", "&#8716;"), C.sub = C.subset = u(st, "\\subset ", "&sub;"), C.sup = C.supset = C.superset = u(st, "\\supset ", "&sup;"), C.nsub = C.notsub = C.nsubset = C.notsubset = u(st, "\\not\\subset ", "&#8836;"), C.nsup = C.notsup = C.nsupset = C.notsupset = C.nsuperset = C.notsuperset = u(st, "\\not\\supset ", "&#8837;"), C.sube = C.subeq = C.subsete = C.subseteq = u(st, "\\subseteq ", "&sube;"), C.supe = C.supeq = C.supsete = C.supseteq = C.supersete = C.superseteq = u(st, "\\supseteq ", "&supe;"), C.nsube = C.nsubeq = C.notsube = C.notsubeq = C.nsubsete = C.nsubseteq = C.notsubsete = C.notsubseteq = u(st, "\\not\\subseteq ", "&#8840;"), C.nsupe = C.nsupeq = C.notsupe = C.notsupeq = C.nsupsete = C.nsupseteq = C.notsupsete = C.notsupseteq = C.nsupersete = C.nsuperseteq = C.notsupersete = C.notsuperseteq = u(st, "\\not\\supseteq ", "&#8841;"), C.N = C.naturals = C.Naturals = u(it, "\\mathbb{N}", "&#8469;"), C.P = C.primes = C.Primes = C.projective = C.Projective = C.probability = C.Probability = u(it, "\\mathbb{P}", "&#8473;"), C.Z = C.integers = C.Integers = u(it, "\\mathbb{Z}", "&#8484;"), C.Q = C.rationals = C.Rationals = u(it, "\\mathbb{Q}", "&#8474;"), C.R = C.reals = C.Reals = u(it, "\\mathbb{R}", "&#8477;"), C.C = C.complex = C.Complex = C.complexes = C.Complexes = C.complexplane = C.Complexplane = C.ComplexPlane = u(it, "\\mathbb{C}", "&#8450;"), C.H = C.Hamiltonian = C.quaternions = C.Quaternions = u(it, "\\mathbb{H}", "&#8461;"), C.quad = C.emsp = u(it, "\\quad ", "    "), C.qquad = u(it, "\\qquad ", "        "), C.diamond = u(it, "\\diamond ", "&#9671;"), C.bigtriangleup = u(it, "\\bigtriangleup ", "&#9651;"), C.ominus = u(it, "\\ominus ", "&#8854;"), C.uplus = u(it, "\\uplus ", "&#8846;"), C.bigtriangledown = u(it, "\\bigtriangledown ", "&#9661;"), C.sqcap = u(it, "\\sqcap ", "&#8851;"), C.triangleleft = u(it, "\\triangleleft ", "&#8882;"), C.sqcup = u(it, "\\sqcup ", "&#8852;"), C.triangleright = u(it, "\\triangleright ", "&#8883;"), C.odot = C.circledot = u(it, "\\odot ", "&#8857;"), C.bigcirc = u(it, "\\bigcirc ", "&#9711;"), C.dagger = u(it, "\\dagger ", "&#0134;"), C.ddagger = u(it, "\\ddagger ", "&#135;"), C.wr = u(it, "\\wr ", "&#8768;"), C.amalg = u(it, "\\amalg ", "&#8720;"), C.models = u(it, "\\models ", "&#8872;"), C.prec = u(it, "\\prec ", "&#8826;"), C.succ = u(it, "\\succ ", "&#8827;"), C.preceq = u(it, "\\preceq ", "&#8828;"), C.succeq = u(it, "\\succeq ", "&#8829;"), C.simeq = u(it, "\\simeq ", "&#8771;"), C.mid = u(it, "\\mid ", "&#8739;"), C.ll = u(it, "\\ll ", "&#8810;"), C.gg = u(it, "\\gg ", "&#8811;"), C.parallel = u(it, "\\parallel ", "&#8741;"), C.nparallel = u(it, "\\nparallel ", "&#8742;"), C.bowtie = u(it, "\\bowtie ", "&#8904;"), C.sqsubset = u(it, "\\sqsubset ", "&#8847;"), C.sqsupset = u(it, "\\sqsupset ", "&#8848;"), C.smile = u(it, "\\smile ", "&#8995;"), C.sqsubseteq = u(it, "\\sqsubseteq ", "&#8849;"), C.sqsupseteq = u(it, "\\sqsupseteq ", "&#8850;"), C.doteq = u(it, "\\doteq ", "&#8784;"), C.frown = u(it, "\\frown ", "&#8994;"), C.vdash = u(it, "\\vdash ", "&#8870;"), C.dashv = u(it, "\\dashv ", "&#8867;"), C.nless = u(it, "\\nless ", "&#8814;"), C.ngtr = u(it, "\\ngtr ", "&#8815;"), C.longleftarrow = u(it, "\\longleftarrow ", "&#8592;"), C.longrightarrow = u(it, "\\longrightarrow ", "&#8594;"), C.Longleftarrow = u(it, "\\Longleftarrow ", "&#8656;"), C.Longrightarrow = u(it, "\\Longrightarrow ", "&#8658;"), C.longleftrightarrow = u(it, "\\longleftrightarrow ", "&#8596;"), C.updownarrow = u(it, "\\updownarrow ", "&#8597;"), C.Longleftrightarrow = u(it, "\\Longleftrightarrow ", "&#8660;"), C.Updownarrow = u(it, "\\Updownarrow ", "&#8661;"), C.mapsto = u(it, "\\mapsto ", "&#8614;"), C.nearrow = u(it, "\\nearrow ", "&#8599;"), C.hookleftarrow = u(it, "\\hookleftarrow ", "&#8617;"), C.hookrightarrow = u(it, "\\hookrightarrow ", "&#8618;"), C.searrow = u(it, "\\searrow ", "&#8600;"), C.leftharpoonup = u(it, "\\leftharpoonup ", "&#8636;"), C.rightharpoonup = u(it, "\\rightharpoonup ", "&#8640;"), C.swarrow = u(it, "\\swarrow ", "&#8601;"), C.leftharpoondown = u(it, "\\leftharpoondown ", "&#8637;"), C.rightharpoondown = u(it, "\\rightharpoondown ", "&#8641;"), C.nwarrow = u(it, "\\nwarrow ", "&#8598;"), C.ldots = u(it, "\\ldots ", "&#8230;"), C.cdots = u(it, "\\cdots ", "&#8943;"), C.vdots = u(it, "\\vdots ", "&#8942;"), C.ddots = u(it, "\\ddots ", "&#8945;"), C.surd = u(it, "\\surd ", "&#8730;"), C.triangle = u(it, "\\triangle ", "&#9651;"), C.ell = u(it, "\\ell ", "&#8467;"), C.top = u(it, "\\top ", "&#8868;"), C.flat = u(it, "\\flat ", "&#9837;"), C.natural = u(it, "\\natural ", "&#9838;"), C.sharp = u(it, "\\sharp ", "&#9839;"), C.wp = u(it, "\\wp ", "&#8472;"), C.bot = u(it, "\\bot ", "&#8869;"), C.clubsuit = u(it, "\\clubsuit ", "&#9827;"), C.diamondsuit = u(it, "\\diamondsuit ", "&#9826;"), C.heartsuit = u(it, "\\heartsuit ", "&#9825;"), C.spadesuit = u(it, "\\spadesuit ", "&#9824;"), C.parallelogram = u(it, "\\parallelogram ", "&#9649;"), C.square = u(it, "\\square ", "&#11036;"), C.oint = u(it, "\\oint ", "&#8750;"), C.bigcap = u(it, "\\bigcap ", "&#8745;"), C.bigcup = u(it, "\\bigcup ", "&#8746;"), C.bigsqcup = u(it, "\\bigsqcup ", "&#8852;"), C.bigvee = u(it, "\\bigvee ", "&#8744;"), C.bigwedge = u(it, "\\bigwedge ", "&#8743;"), C.bigodot = u(it, "\\bigodot ", "&#8857;"), C.bigotimes = u(it, "\\bigotimes ", "&#8855;"), C.bigoplus = u(it, "\\bigoplus ", "&#8853;"), C.biguplus = u(it, "\\biguplus ", "&#8846;"), C.lfloor = u(it, "\\lfloor ", "&#8970;"), C.rfloor = u(it, "\\rfloor ", "&#8971;"), C.lceil = u(it, "\\lceil ", "&#8968;"), C.rceil = u(it, "\\rceil ", "&#8969;"), C.opencurlybrace = C.lbrace = u(it, "\\lbrace ", "{"), C.closecurlybrace = C.rbrace = u(it, "\\rbrace ", "}"), C.lbrack = u(it, "["), C.rbrack = u(it, "]"), C.slash = u(it, "/"), C.vert = u(it, "|"), C.perp = C.perpendicular = u(it, "\\perp ", "&perp;"), C.nabla = C.del = u(it, "\\nabla ", "&nabla;"), C.hbar = u(it, "\\hbar ", "&#8463;"), C.AA = C.Angstrom = C.angstrom = u(it, "\\text\\AA ", "&#8491;"), C.ring = C.circ = C.circle = u(it, "\\circ ", "&#8728;"), C.bull = C.bullet = u(it, "\\bullet ", "&bull;"), C.setminus = C.smallsetminus = u(it, "\\setminus ", "&#8726;"), C.not = C["¬"] = C.neg = u(it, "\\neg ", "&not;"), C["…"] = C.dots = C.ellip = C.hellip = C.ellipsis = C.hellipsis = u(it, "\\dots ", "&hellip;"), C.converges = C.darr = C.dnarr = C.dnarrow = C.downarrow = u(it, "\\downarrow ", "&darr;"), C.dArr = C.dnArr = C.dnArrow = C.Downarrow = u(it, "\\Downarrow ", "&dArr;"), C.diverges = C.uarr = C.uparrow = u(it, "\\uparrow ", "&uarr;"), C.uArr = C.Uparrow = u(it, "\\Uparrow ", "&uArr;"), C.to = u(st, "\\to ", "&rarr;"), C.rarr = C.rightarrow = u(it, "\\rightarrow ", "&rarr;"), C.implies = u(st, "\\Rightarrow ", "&rArr;"), C.rArr = C.Rightarrow = u(it, "\\Rightarrow ", "&rArr;"), C.gets = u(st, "\\gets ", "&larr;"), C.larr = C.leftarrow = u(it, "\\leftarrow ", "&larr;"), C.impliedby = u(st, "\\Leftarrow ", "&lArr;"), C.lArr = C.Leftarrow = u(it, "\\Leftarrow ", "&lArr;"), C.harr = C.lrarr = C.leftrightarrow = u(it, "\\leftrightarrow ", "&harr;"), C.iff = u(st, "\\Leftrightarrow ", "&hArr;"), C.hArr = C.lrArr = C.Leftrightarrow = u(it, "\\Leftrightarrow ", "&hArr;"), C.Re = C.Real = C.real = u(it, "\\Re ", "&real;"), C.Im = C.imag = C.image = C.imagin = C.imaginary = C.Imaginary = u(it, "\\Im ", "&image;"), C.part = C.partial = u(it, "\\partial ", "&part;"), C.infty = C.infin = C.infinity = u(it, "\\infty ", "&infin;"), C.alef = C.alefsym = C.aleph = C.alephsym = u(it, "\\aleph ", "&alefsym;"), C.xist = C.xists = C.exist = C.exists = u(it, "\\exists ", "&exist;"), C.and = C.land = C.wedge = u(it, "\\wedge ", "&and;"), C.or = C.lor = C.vee = u(it, "\\vee ", "&or;"), C.o = C.O = C.empty = C.emptyset = C.oslash = C.Oslash = C.nothing = C.varnothing = u(st, "\\varnothing ", "&empty;"), C.cup = C.union = u(st, "\\cup ", "&cup;"), C.cap = C.intersect = C.intersection = u(st, "\\cap ", "&cap;"), C.deg = C.degree = u(it, "\\degree ", "&deg;"), C.ang = C.angle = u(it, "\\angle ", "&ang;"), C.measuredangle = u(it, "\\measuredangle ", "&#8737;"); var ft = m(it, (function (t, e) { t.createLeftOf = function (t) { t.options.autoSubscriptNumerals && t.parent !== t.parent.parent.sub && (t[w] instanceof pt && !1 !== t[w].isItalic || t[w] instanceof _t && t[w][w] instanceof pt && !1 !== t[w][w].isItalic) ? (C._().createLeftOf(t), e.createLeftOf.call(this, t), t.insRightOf(t.parent.parent)) : e.createLeftOf.call(this, t) } })), pt = m(nt, (function (t, e) { t.init = function (t, n) { e.init.call(this, t, '<var class="' + (n || t) + '">' + (n || t) + "</var>") }, t.text = function () { var t = this.ctrlSeq; return !this[w] || this[w] instanceof pt || this[w] instanceof st || "\\ " === this[w].ctrlSeq || (t = "*" + t), !this[1] || this[1] instanceof st || this[1] instanceof _t || (t += "*"), t } })); L.p.autoCommands = { _maxLength: 0 }, E.autoCommands = function (t) { if (!/^[a-z]+(?: [a-z]+)*$/i.test(t)) throw '"' + t + '" not a space-delimited list of only letters'; for (var e = t.split(" "), n = {}, i = 0, s = 0; s < e.length; s += 1) { var a = e[s]; if (a.length < 2) throw 'autocommand "' + a + '" not minimum length of 2'; if (C[a] === wt) throw '"' + a + '" is a built-in operator name'; n[a] = 1, i = r(i, a.length) } return n._maxLength = i, n }; var dt = m(pt, (function (t, e) { function n(t) { return t instanceof nt && !(t instanceof st) } t.init = function (t) { return e.init.call(this, this.letter = t) }, t.createLeftOf = function (t) { var n = t.options.autoCommands, i = n._maxLength; if (0 < i) { for (var s = this.letter, r = t[w], a = 1; r instanceof dt && a < i;)s = r.letter + s, r = r[w], a += 1; for (; s.length;) { if (n.hasOwnProperty(s)) { for (a = 2, r = t[w]; a < s.length; a += 1, r = r[w]); return j(r, t[w]).remove(), t[w] = r[w], C[s](s).createLeftOf(t) } s = s.slice(1) } } e.createLeftOf.apply(this, arguments) }, t.italicize = function (t) { return this.isItalic = t, this.jQ.toggleClass("mq-operator-name", !t), this }, t.finalizeTree = t.siblingDeleted = t.siblingCreated = function (t, e) { e !== w && this[1] instanceof dt || this.autoUnItalicize(t) }, t.autoUnItalicize = function (t) { var e = t.autoOperatorNames; if (0 !== e._maxLength) { for (var i = this.letter, r = this[w]; r instanceof dt; r = r[w])i = r.letter + i; for (var a = this[1]; a instanceof dt; a = a[1])i += a.letter; j(r[1] || this.parent.ends[w], a[w] || this.parent.ends[1]).each((function (t) { t.italicize(!0).jQ.removeClass("mq-first mq-last"), t.ctrlSeq = t.letter })); t: for (var o = 0, l = r[1] || this.parent.ends[w]; o < i.length; o += 1, l = l[1])for (var c = s(e._maxLength, i.length - o); 0 < c; --c) { var h = i.slice(o, o + c); if (e.hasOwnProperty(h)) { for (var u = 0, f = l; u < c; u += 1, f = f[1]) { f.italicize(!1); var p = f } var d = mt.hasOwnProperty(h); l.ctrlSeq = (d ? "\\" : "\\operatorname{") + l.ctrlSeq, p.ctrlSeq += d ? " " : "}", vt.hasOwnProperty(h) && p[w][w][w].jQ.addClass("mq-last"), n(l[w]) && l.jQ.addClass("mq-first"), n(p[1]) && p.jQ.addClass("mq-last"), o += c - 1, l = p; continue t } } } } })), mt = {}, gt = L.p.autoOperatorNames = { _maxLength: 9 }, vt = { limsup: 1, liminf: 1, projlim: 1, injlim: 1 }; !function () { for (var t = "arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" "), e = 0; e < t.length; e += 1)mt[t[e]] = gt[t[e]] = 1; var n = "sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "); for (e = 0; e < n.length; e += 1)mt[n[e]] = 1; var i = "sin cos tan sec cosec csc cotan cot ctg".split(" "); for (e = 0; e < i.length; e += 1)gt[i[e]] = gt["arc" + i[e]] = gt[i[e] + "h"] = gt["ar" + i[e] + "h"] = gt["arc" + i[e] + "h"] = 1; var s = "gcf hcf lcm proj span".split(" "); for (e = 0; e < s.length; e += 1)gt[s[e]] = 1 }(), E.autoOperatorNames = function (t) { if (!/^[a-z]+(?: [a-z]+)*$/i.test(t)) throw '"' + t + '" not a space-delimited list of only letters'; for (var e = t.split(" "), n = {}, i = 0, s = 0; s < e.length; s += 1) { var a = e[s]; if (a.length < 2) throw '"' + a + '" not minimum length of 2'; n[a] = 1, i = r(i, a.length) } return n._maxLength = i, n }; var bt, wt = m(nt, (function (t, e) { t.init = function (t) { this.ctrlSeq = t }, t.createLeftOf = function (t) { for (var e = this.ctrlSeq, n = 0; n < e.length; n += 1)dt(e.charAt(n)).createLeftOf(t) }, t.parser = function () { for (var t = this.ctrlSeq, e = rt(), n = 0; n < t.length; n += 1)dt(t.charAt(n)).adopt(e, e.ends[1], 0); return P.succeed(e.children()) } })); for (bt in gt) gt.hasOwnProperty(bt) && (C[bt] = wt); C.operatorname = m(et, (function (t) { t.createLeftOf = a, t.numBlocks = function () { return 1 }, t.parser = function () { return V.block.map((function (t) { return t.children() })) } })), C.f = m(dt, (function (t, e) { t.init = function () { nt.p.init.call(this, this.letter = "f", '<var class="mq-f">f</var>') }, t.italicize = function (t) { return this.jQ.html("f").toggleClass("mq-f", t), e.italicize.apply(this, arguments) } })), C[" "] = C.space = u(it, "\\ ", "&nbsp;"), C["'"] = C.prime = u(it, "'", "&prime;"), C.backslash = u(it, "\\backslash ", "\\"), T["\\"] || (T["\\"] = C.backslash), C.$ = u(it, "\\$", "$"); var xt = m(nt, (function (t, e) { t.init = function (t, n) { e.init.call(this, t, '<span class="mq-nonSymbola">' + (n || t) + "</span>") } })); C["@"] = xt, C["&"] = u(xt, "\\&", "&amp;"), C["%"] = u(xt, "\\%", "%"), C.alpha = C.beta = C.gamma = C.delta = C.zeta = C.eta = C.theta = C.iota = C.kappa = C.mu = C.nu = C.xi = C.rho = C.sigma = C.tau = C.chi = C.psi = C.omega = m(pt, (function (t, e) { t.init = function (t) { e.init.call(this, "\\" + t + " ", "&" + t + ";") } })), C.phi = u(pt, "\\phi ", "&#981;"), C.phiv = C.varphi = u(pt, "\\varphi ", "&phi;"), C.epsilon = u(pt, "\\epsilon ", "&#1013;"), C.epsiv = C.varepsilon = u(pt, "\\varepsilon ", "&epsilon;"), C.piv = C.varpi = u(pt, "\\varpi ", "&piv;"), C.sigmaf = C.sigmav = C.varsigma = u(pt, "\\varsigma ", "&sigmaf;"), C.thetav = C.vartheta = C.thetasym = u(pt, "\\vartheta ", "&thetasym;"), C.upsilon = C.upsi = u(pt, "\\upsilon ", "&upsilon;"), C.gammad = C.Gammad = C.digamma = u(pt, "\\digamma ", "&#989;"), C.kappav = C.varkappa = u(pt, "\\varkappa ", "&#1008;"), C.rhov = C.varrho = u(pt, "\\varrho ", "&#1009;"), C.pi = C["π"] = u(xt, "\\pi ", "&pi;"), C.lambda = u(xt, "\\lambda ", "&lambda;"), C.Upsilon = C.Upsi = C.upsih = C.Upsih = u(nt, "\\Upsilon ", '<var style="font-family: serif">&upsih;</var>'), C.Gamma = C.Delta = C.Theta = C.Lambda = C.Xi = C.Pi = C.Sigma = C.Phi = C.Psi = C.Omega = C.forall = m(it, (function (t, e) { t.init = function (t) { e.init.call(this, "\\" + t + " ", "&" + t + ";") } })); var qt = m(et, (function (t) { t.init = function (t) { this.latex = t }, t.createLeftOf = function (t) { var e = V.parse(this.latex); e.children().adopt(t.parent, t[w], t[1]), t[w] = e.ends[1], e.jQize().insertBefore(t.jQ), e.finalizeInsert(t.options, t), e.ends[1][1].siblingCreated && e.ends[1][1].siblingCreated(t.options, w), e.ends[w][w].siblingCreated && e.ends[w][w].siblingCreated(t.options, 1), t.parent.bubble("reflow") }, t.parser = function () { var t = V.parse(this.latex).children(); return P.succeed(t) } })); C["¹"] = u(qt, "^1"), C["²"] = u(qt, "^2"), C["³"] = u(qt, "^3"), C["¼"] = u(qt, "\\frac14"), C["½"] = u(qt, "\\frac12"), C["¾"] = u(qt, "\\frac34"), tt = m(st, (function (t) { t.init = it.prototype.init, t.contactWeld = t.siblingCreated = t.siblingDeleted = function (t, e) { if (1 !== e) return this.jQ[0].className = !this[w] || this[w] instanceof st ? "" : "mq-binary-operator", this } })), C["+"] = u(tt, "+", "+"), C["–"] = C["-"] = u(tt, "-", "&minus;"), C["±"] = C.pm = C.plusmn = C.plusminus = u(tt, "\\pm ", "&plusmn;"), C.mp = C.mnplus = C.minusplus = u(tt, "\\mp ", "&#8723;"), T["*"] = C.sdot = C.cdot = u(st, "\\cdot ", "&middot;", "*"); var yt = m(st, (function (t, e) { t.init = function (t, n) { this.data = t, n = (this.strict = n) ? "Strict" : "", e.init.call(this, t["ctrlSeq" + n], t["html" + n], t["text" + n]) }, t.swap = function (t) { t = (this.strict = t) ? "Strict" : "", this.ctrlSeq = this.data["ctrlSeq" + t], this.jQ.html(this.data["html" + t]), this.textTemplate = [this.data["text" + t]] }, t.deleteTowards = function (t, n) { if (t === w && !this.strict) return this.swap(!0), void this.bubble("reflow"); e.deleteTowards.apply(this, arguments) } })); xt = { ctrlSeq: "\\le ", html: "&le;", text: "≤", ctrlSeqStrict: "<", htmlStrict: "&lt;", textStrict: "<" }, qt = { ctrlSeq: "\\ge ", html: "&ge;", text: "≥", ctrlSeqStrict: ">", htmlStrict: "&gt;", textStrict: ">" }; C["<"] = C.lt = u(yt, xt, !0), C[">"] = C.gt = u(yt, qt, !0), C["≤"] = C.le = C.leq = u(yt, xt, !1), C["≥"] = C.ge = C.geq = u(yt, qt, !1); var Ot = m(st, (function (t, e) { t.init = function () { e.init.call(this, "=", "=") }, t.createLeftOf = function (t) { if (t[w] instanceof yt && t[w].strict) return t[w].swap(!1), void t[w].bubble("reflow"); e.createLeftOf.apply(this, arguments) } })); C["="] = Ot, C["×"] = C.times = u(st, "\\times ", "&times;", "[x]"), C["÷"] = C.div = C.divide = C.divides = u(st, "\\div ", "&divide;", "[/]"), T["~"] = C.sim = u(st, "\\sim ", "~", "~"); var kt, jt, Ct, Tt = a, Qt = document.createElement("div").style; for (Ct in { transform: 1, WebkitTransform: 1, MozTransform: 1, OTransform: 1, msTransform: 1 }) if (Ct in Qt) { jt = Ct; break } kt = jt ? function (t, e, n) { t.css(jt, "scale(" + e + "," + n + ")") } : "filter" in Qt ? (Tt = function (t) { t.className = t.className }, function (t, e, n) { e /= 1 + (n - 1) / 2, t.css("fontSize", n + "em"), t.hasClass("mq-matrixed-container") || t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>'); var i = t.children().css("filter", "progid:DXImageTransform.Microsoft.Matrix(M11=" + e + ",SizingMethod='auto expand')"); function s() { t.css("marginRight", (i.width() - 1) * (e - 1) / e + "px") } s(); var r = setInterval(s); q(window).load((function () { clearTimeout(r), s() })) }) : function (t, e, n) { t.css("fontSize", n + "em") }, tt = m(et, (function (t, e) { t.init = function (t, n, i) { e.init.call(this, t, "<" + n + " " + i + ">&0</" + n + ">") } })), C.mathrm = u(tt, "\\mathrm", "span", 'class="mq-roman mq-font"'), C.mathit = u(tt, "\\mathit", "i", 'class="mq-font"'), C.mathbf = u(tt, "\\mathbf", "b", 'class="mq-font"'), C.mathsf = u(tt, "\\mathsf", "span", 'class="mq-sans-serif mq-font"'), C.mathtt = u(tt, "\\mathtt", "span", 'class="mq-monospace mq-font"'), C.underline = u(tt, "\\underline", "span", 'class="mq-non-leaf mq-underline"'), C.overline = C.bar = u(tt, "\\overline", "span", 'class="mq-non-leaf mq-overline"'), C.overrightarrow = u(tt, "\\overrightarrow", "span", 'class="mq-non-leaf mq-overarrow mq-arrow-right"'), C.overleftarrow = u(tt, "\\overleftarrow", "span", 'class="mq-non-leaf mq-overarrow mq-arrow-left"'), C.textcolor = m(et, (function (t, e) { t.setColor = function (t) { this.color = t, this.htmlTemplate = '<span class="mq-textcolor" style="color:' + t + '">&0</span>' }, t.latex = function () { return "\\textcolor{" + this.color + "}{" + this.blocks[0].latex() + "}" }, t.parser = function () { var t = this, n = P.optWhitespace, i = P.string, s = P.regex; return n.then(i("{")).then(s(/^[#\w\s.,()%-]*/)).skip(i("}")).then((function (n) { return t.setColor(n), e.parser.call(t) })) } })), C.class = m(et, (function (t, e) { t.parser = function () { var t = this, n = P.string, i = P.regex; return P.optWhitespace.then(n("{")).then(i(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then((function (n) { return t.htmlTemplate = '<span class="mq-class ' + n + '">&0</span>', e.parser.call(t) })) } })); var _t = m(et, (function (t, e) { t.ctrlSeq = "_{...}^{...}", t.createLeftOf = function (t) { if (t[w] || !t.options.supSubsRequireOperand) return e.createLeftOf.apply(this, arguments) }, t.contactWeld = function (t) { for (var e = w; e; e = e === w && 1)if (this[e] instanceof _t) { for (var n = "sub"; n; n = "sub" === n && "sup") { var i, s, r = this[n], a = this[e][n]; r && (a ? r.isEmpty() ? s = y(a, 0, a.ends[w]) : (r.jQ.children().insAtDirEnd(-e, a.jQ), s = y(a, (i = r.children().disown()).ends[1], a.ends[w]), e === w ? i.adopt(a, a.ends[1], 0) : i.adopt(a, 0, a.ends[w])) : this[e].addBlock(r.disown()), this.placeCursor = function (t, n) { return function (i) { i.insAtDirEnd(-e, t || n) } }(a, r)) } this.remove(), t && t[w] === this && (1 === e && s ? s[w] ? t.insRightOf(s[w]) : t.insAtLeftEnd(s.parent) : t.insRightOf(this[e])); break } this.respace() }, L.p.charsThatBreakOutOfSupSub = "", t.finalizeTree = function () { this.ends[w].write = function (t, e) { if (t.options.autoSubscriptNumerals && this === this.parent.sub) { if ("_" === e) return; var n = this.chToCmd(e); return n instanceof nt ? t.deleteSelection() : t.clearSelection().insRightOf(this.parent), n.createLeftOf(t.show()) } t[w] && !t[1] && !t.selection && -1 < t.options.charsThatBreakOutOfSupSub.indexOf(e) && t.insRightOf(this.parent), rt.p.write.apply(this, arguments) } }, t.moveTowards = function (t, n, i) { n.options.autoSubscriptNumerals && !this.sup ? n.insDirOf(t, this) : e.moveTowards.apply(this, arguments) }, t.deleteTowards = function (t, n) { var i; n.options.autoSubscriptNumerals && this.sub ? ((i = this.sub.ends[-t]) instanceof nt ? i.remove() : i && i.deleteTowards(t, n.insAtDirEnd(-t, this.sub)), this.sub.isEmpty() && (this.sub.deleteOutOf(w, n.insAtLeftEnd(this.sub)), this.sup && n.insDirOf(-t, this))) : e.deleteTowards.apply(this, arguments) }, t.latex = function () { function t(t, e) { var n = e && e.latex(); return e ? t + (1 === n.length ? n : "{" + (n || " ") + "}") : "" } return t("_", this.sub) + t("^", this.sup) }, t.respace = t.siblingCreated = t.siblingDeleted = function (t, e) { 1 !== e && this.jQ.toggleClass("mq-limit", "\\int " === this[w].ctrlSeq) }, t.addBlock = function (t) { "sub" === this.supsub ? ((this.sup = this.upInto = this.sub.upOutOf = t).adopt(this, this.sub, 0).downOutOf = this.sub, t.jQ = q('<span class="mq-sup"/>').append(t.jQ.children()).attr(i, t.id).prependTo(this.jQ)) : ((this.sub = this.downInto = this.sup.downOutOf = t).adopt(this, 0, this.sup).upOutOf = this.sup, t.jQ = q('<span class="mq-sub"></span>').append(t.jQ.children()).attr(i, t.id).appendTo(this.jQ.removeClass("mq-sup-only")), this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>')); for (var e = 0; e < 2; e += 1)!function (t, e, n, i) { t[e].deleteOutOf = function (s, r) { var a; r.insDirOf(this[s] ? -s : s, this.parent), this.isEmpty() || (a = this.ends[s], this.children().disown().withDirAdopt(s, r.parent, r[s], r[-s]).jQ.insDirOf(-s, r.jQ), r[-s] = a), t.supsub = n, delete t[e], delete t[i + "Into"], t[n][i + "OutOf"] = St, delete t[n].deleteOutOf, "sub" === e && q(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(), this.remove() } }(this, "sub sup".split(" ")[e], "sup sub".split(" ")[e], "down up".split(" ")[e]) } })); function St(t) { var e = this.parent, n = t; do { if (n[1]) return t.insLeftOf(e) } while ((n = n.parent.parent) !== e); t.insRightOf(e) } C.subscript = C._ = m(_t, (function (t, e) { t.supsub = "sub", t.htmlTemplate = '<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>', t.textTemplate = ["_"], t.finalizeTree = function () { this.downInto = this.sub = this.ends[w], this.sub.upOutOf = St, e.finalizeTree.call(this) } })), C.superscript = C.supscript = C["^"] = m(_t, (function (t, e) { t.supsub = "sup", t.htmlTemplate = '<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>', t.textTemplate = ["^"], t.finalizeTree = function () { this.upInto = this.sup = this.ends[1], this.sup.downOutOf = St, e.finalizeTree.call(this) } })); var Dt = m(et, (function (t, e) { t.init = function (t, e) { e = '<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big class="sum">' + e + '</big><span class="mq-from"><span>&0</span></span></span>', nt.prototype.init.call(this, t, e) }, t.createLeftOf = function (t) { e.createLeftOf.apply(this, arguments), t.options.sumStartsWithNEquals && (dt("n").createLeftOf(t), Ot().createLeftOf(t)) }, t.latex = function () { function t(t) { return 1 === t.length ? t : "{" + (t || " ") + "}" } return this.ctrlSeq + "_" + t(this.ends[w].latex()) + "^" + t(this.ends[1].latex()) }, t.parser = function () { for (var t = P.string, e = P.optWhitespace, n = P.succeed, i = V.block, s = this, r = s.blocks = [rt(), rt()], a = 0; a < r.length; a += 1)r[a].adopt(s, s.ends[1], 0); return e.then(t("_").or(t("^"))).then((function (t) { var e = r["_" === t ? 0 : 1]; return i.then((function (t) { return t.children().adopt(e, e.ends[1], 0), n(s) })) })).many().result(s) }, t.finalizeTree = function () { this.downInto = this.ends[w], this.upInto = this.ends[1], this.ends[w].upOutOf = this.ends[1], this.ends[1].downOutOf = this.ends[w] } })); xt = C.matrix = m(et, (function (t, e) { var n = m(rt, (function (t, e) { t.init = function (t, n) { return this.column = t, this.row = n, e.init.call(this) }, t.keystroke = function (t, n, i) { switch (t) { case "Shift-Spacebar": return n.preventDefault(), this.parent.insertColumn(this); case "Shift-Enter": return this.parent.insertRow(this) }return e.keystroke.apply(this, arguments) }, t.deleteOutOf = function (t, n) { var i = this, s = arguments; this.parent.backspace(this, t, n, (function () { return e.deleteOutOf.apply(i, s) })) } })); t.parentheses = { left: null, right: null }, t.maximum = { rows: 5, columns: 5 }, t.defaults = { rows: 1, columns: 1 }, t.ctrlSeq = "\\matrix", t.createBlocks = function () { var t, e, i = this, s = i.blocks = [], r = 0; this.htmlTemplate.replace(/&\d+/g, (function (a, o) { e = t === (o = i.htmlTemplate.substring(0, o).match(/<tr[^>]*>/gi).length - 1) ? e + 1 : 0, s[r] = n(e, o), s[r].adopt(i, i.ends[1], 0), t = o, r++ })) }, t.edited = function () { var t, e = (t = this.jQ.children("table")).outerHeight() / +t.css("fontSize").slice(0, -2); (t = this.jQ.children(".mq-paren")).length && kt(t, s(1 + .2 * (e - 1), 1.2), 1.05 * e) }, t.latex = function () { for (var t, e, n = this.getMatrixName(), i = "\\begin{" + n + "}", s = 0; s < this.blocks.length; s++)t = this.blocks[s].row, void 0 !== e && (i += e !== t ? "\\\\" : "&"), e = t, i += this.blocks[s].latex(); return i + "\\end{" + n + "}" }, t.createLeftOf = function (n) { this.cursor = n; var i = Math.min(this.defaults.rows, this.maximum.rows), s = Math.min(this.defaults.columns, this.maximum.columns); this.defaultHtmlTemplate = this.defaultHtmlTemplate || this.generateHtmlTemplate(i, s), t.htmlTemplate = this.defaultHtmlTemplate, e.createLeftOf.call(this, n) }, t.getMatrixName = function () { return this.ctrlSeq.replace("\\", "") }, t.generateHtmlTemplate = function (t, e) { var n = '<span class="mq-matrix mq-non-leaf">' + a(this.parentheses.left); n += '<table class="mq-non-leaf">', t = Math.min(t, this.maximum.rows), e = Math.min(e, this.maximum.columns); for (var i = 0, s = 0; s < t; s++) { n += "<tr>"; for (var r = 0; r < e; r++)n += "<td>&" + i + "</td>", i++; n += "</tr>" } return n += "</table>", n += a(this.parentheses.right) + "</span>"; function a(t) { return t ? '<span class="mq-paren mq-scaled">' + t + "</span>" : "" } }, t.htmlTemplate = t.generateHtmlTemplate(1, 1), t.parser = function () { var t = P.regex, e = this, i = this.getMatrixName(), s = RegExp("^(.*)\\\\end{" + i + "}"), r = RegExp("\\\\end{" + i + "}"); return t(s).then((function (t) { var i, s = [], a = t.replace(r, "").split("\\\\"), o = Math.min(a.length, e.maximum.rows), l = 0; for (h = 0; h < o; h++)l = Math.max(l, (i = a[h].split("&")).length); for (l = Math.min(l, e.maximum.columns), h = 0; h < o; h++)for (t = 0, i = a[h].split("&"); t < l; t++) { var c = n(t, h); V.parse(i[t] || " ").children().adopt(c, c.ends[1], 0), s.push(c) } e.htmlTemplate = e.generateHtmlTemplate(o, l), e.blocks = s; for (var h = 0; h < s.length; h += 1)s[h].adopt(e, e.ends[1], 0); return P.succeed(e) })) }, t.finalizeTree = function () { var t = this.jQ.find("table"); t.length && (this.relink(), t.removeClass((function (t, e) { return (e = e.match(/mq-rows-\d+/g)) && e.join(" ") || "" })), t.addClass("mq-rows-" + t.find("tr").length)) }, t.relink = function () { var t = this.jQ.find("td"), e = O.byId[t.first().attr(i)], n = O.byId[t.last().attr(i)], s = t.eq(0).closest("tr"), r = []; t.each((function (e) { var n = O.byId[q(this).attr(i)], a = t.eq(e + 1), o = q(this).closest("tr").next("tr"), l = q(this).closest("tr").index(); e = q(this).index(); a.length && (a = O.byId[a.attr(i)], (n[1] = a)[w] = n), (o = o.length ? o.find("td").eq(e) : s.find("td").eq(e + 1)).length && (o = O.byId[o.attr(i)], (n.downOutOf = o).upOutOf = n), n.column = e, n.row = l, r.push(n) })), this.ends[w] = e, this.ends[1] = n, e && e[w] && delete e[w], n && n[1] && delete n[1], this.blocks = r }, t.deleteCell = function (t) { var e, n = t.jQ.closest("tr"), s = t.jQ.index(), r = n.index(), a = n.find("td").not(t.jQ), o = this.jQ.find("tr").not(n).map((function () { return q(this).find("td")[s] })), l = 1 === this.jQ.find("td").length; function c() { return O.byId[q(this).attr(i)].isEmpty() } return a.filter(c).length === a.length && o.length && (a.remove(), t.jQ.remove(), n.remove(), this.finalizeTree()), o.filter(c).length === o.length && a.length && (o.remove(), t.jQ.remove(), this.finalizeTree()), l || (r = Math.min(r, this.jQ.find("tr").length - 1), s = Math.min(s, this.jQ.find("tr").eq(r).find("td").length - 1), e = O.byId[this.jQ.find("tr").eq(r).find("td").eq(s).attr(i)]), e }, t.addRow = function (t) { if (!(this.jQ.find("tr").length >= this.maximum.rows)) { for (var e, s, r = t.find("td").length, a = q("<tr></tr>"), o = 0; o < r; o++)(e = n()).parent = this, e.jQ = q('<td class="mq-empty">').attr(i, e.id), a.append(e.jQ), s = s || e; return a.insertAfter(t), s } }, t.addColumn = function (t) { if (!(t.closest("tr").find("td").length >= this.maximum.columns)) { var e, s = t.index(), r = (t = t.closest("tr").index(), this), a = []; return this.jQ.find("tr").each((function () { (e = n()).parent = r, e.jQ = q('<td class="mq-empty">').attr(i, e.id), e.jQ.insertAfter(q(this).find("td").eq(s)), a.push(e) })), a[t] } }, t.insertColumn = function (t) { (newBlock = this.addColumn(t.jQ)) && (this.cursor = this.cursor || this.parent.cursor, this.finalizeTree(), this.bubble("redraw").cursor.insAtRightEnd(newBlock)) }, t.insertRow = function (t) { (newBlock = this.addRow(t.jQ.closest("tr"))) && (this.cursor = this.cursor || this.parent.cursor, this.finalizeTree(), this.bubble("redraw").cursor.insAtRightEnd(newBlock), this.bubble("edited")) }, t.backspace = function (t, e, n, i) { t.isEmpty() && ((t = this.deleteCell(t)) ? n.insAtRightEnd(t) : (i(), this.finalizeTree()), this.bubble("edited")) } })); C.pmatrix = m(xt, (function (t, e) { t.ctrlSeq = "\\pmatrix", t.parentheses = { left: "(", right: ")" } })), C.bmatrix = m(xt, (function (t, e) { t.ctrlSeq = "\\bmatrix", t.parentheses = { left: "[", right: "]" } })), C.Bmatrix = m(xt, (function (t, e) { t.ctrlSeq = "\\Bmatrix", t.parentheses = { left: "{", right: "}" } })), C.vmatrix = m(xt, (function (t, e) { t.ctrlSeq = "\\vmatrix", t.parentheses = { left: "|", right: "|" } })), C.Vmatrix = m(xt, (function (t, e) { t.ctrlSeq = "\\Vmatrix", t.parentheses = { left: "‖", right: "‖" } })), C.gather = m(et, (function (t, e) { var n = m(rt, (function (t, e) { t.init = function (t, n) { return this.column = t, this.row = n, e.init.call(this) }, t.keystroke = function (t, n, i) { return "Enter" === t ? this.parent.insertRow(this) : e.keystroke.apply(this, arguments) } })); t.parentheses = { left: null, right: null }, t.maximum = { rows: 1e5, columns: 5 }, t.defaults = { rows: 1, columns: 1 }, t.ctrlSeq = "\\gather", t.createBlocks = function () { var t, e, i = this, s = i.blocks = [], r = 0; this.htmlTemplate.replace(/&\d+/g, (function (a, o) { e = t === (o = i.htmlTemplate.substring(0, o).match(/<tr[^>]*>/gi).length - 1) ? e + 1 : 0, s[r] = n(e, o), s[r].adopt(i, i.ends[1], 0), t = o, r++ })) }, t.edited = function () { var t, e = (t = this.jQ.children("table")).outerHeight() / +t.css("fontSize").slice(0, -2); (t = this.jQ.children(".mq-paren")).length && kt(t, s(1 + .2 * (e - 1), 1.2), 1.05 * e) }, t.latex = function () { this.getMatrixName(); for (var t, e, n = "\\begin{*gather}", i = 0; i < this.blocks.length; i++)t = this.blocks[i].row, void 0 !== e && (n += e !== t ? "\\\\" : ""), e = t, n += this.blocks[i].latex(); return n + "\\end{*gather}" }, t.createLeftOf = function (n) { this.cursor = n; var i = Math.min(this.defaults.rows, this.maximum.rows), s = Math.min(this.defaults.columns, this.maximum.columns); this.defaultHtmlTemplate = this.defaultHtmlTemplate || this.generateHtmlTemplate(i, s), t.htmlTemplate = this.defaultHtmlTemplate, e.createLeftOf.call(this, n) }, t.getMatrixName = function () { return this.ctrlSeq.replace("\\", "") }, t.generateHtmlTemplate = function (t, e) { var n = '<span class="gather mq-non-leaf">' + a(this.parentheses.left); n += '<table class="mq-non-leaf">', t = Math.min(t, this.maximum.rows), e = Math.min(e, this.maximum.columns); for (var i = 0, s = 0; s < t; s++) { n += "<tr>"; for (var r = 0; r < e; r++)n += "<td>&" + i + "</td>", i++; n += "</tr>" } return n += "</table>", n += a(this.parentheses.right) + "</span>"; function a(t) { return t ? '<span class="mq-paren mq-scaled">' + t + "</span>" : "" } }, t.htmlTemplate = t.generateHtmlTemplate(1, 1), t.parser = function () { var t = P.regex, e = this, i = this.getMatrixName(), s = RegExp("^(.*)\\\\end{" + i + "}"), r = RegExp("\\\\end{" + i + "}"); return t(s).then((function (t) { var i, s = [], a = t.replace(r, "").split("\\\\"), o = Math.min(a.length, e.maximum.rows), l = 0; for (h = 0; h < o; h++)l = Math.max(l, (i = a[h].split("")).length); for (l = Math.min(l, e.maximum.columns), h = 0; h < o; h++)for (t = 0, i = a[h].split(""); t < l; t++) { var c = n(t, h); V.parse(i[t] || " ").children().adopt(c, c.ends[1], 0), s.push(c) } e.htmlTemplate = e.generateHtmlTemplate(o, l), e.blocks = s; for (var h = 0; h < s.length; h += 1)s[h].adopt(e, e.ends[1], 0); return P.succeed(e) })) }, t.finalizeTree = function () { var t = this.jQ.find("table"); t.length && (this.relink(), t.removeClass((function (t, e) { return (e = e.match(/mq-rows-\d+/g)) && e.join(" ") || "" })), t.addClass("mq-rows-" + t.find("tr").length), t.addClass("Gather")) }, t.relink = function () { var t = this.jQ.find("td"), e = O.byId[t.first().attr(i)], n = O.byId[t.last().attr(i)], s = t.eq(0).closest("tr"), r = []; t.each((function (e) { var n = O.byId[q(this).attr(i)], a = t.eq(e + 1), o = q(this).closest("tr").next("tr"), l = q(this).closest("tr").index(); e = q(this).index(); a.length && (a = O.byId[a.attr(i)], (n[1] = a)[w] = n), (o = o.length ? o.find("td").eq(e) : s.find("td").eq(e + 1)).length && (o = O.byId[o.attr(i)], (n.downOutOf = o).upOutOf = n), n.column = e, n.row = l, r.push(n) })), this.ends[w] = e, this.ends[1] = n, e && e[w] && delete e[w], n && n[1] && delete n[1], this.blocks = r }, t.deleteCell = function (t) { var e, n = t.jQ.closest("tr"), s = t.jQ.index(), r = n.index(), a = n.find("td").not(t.jQ), o = this.jQ.find("tr").not(n).map((function () { return q(this).find("td")[s] })), l = 1 === this.jQ.find("td").length; function c() { return O.byId[q(this).attr(i)].isEmpty() } return a.filter(c).length === a.length && o.length && (a.remove(), t.jQ.remove(), n.remove(), this.finalizeTree()), o.filter(c).length === o.length && a.length && (o.remove(), t.jQ.remove(), this.finalizeTree()), l || (r = Math.min(r, this.jQ.find("tr").length - 1), s = Math.min(s, this.jQ.find("tr").eq(r).find("td").length - 1), e = O.byId[this.jQ.find("tr").eq(r).find("td").eq(s).attr(i)]), e }, t.addRow = function (t) { if (!(this.jQ.find("tr").length >= this.maximum.rows)) { for (var e, s, r = t.find("td").length, a = q("<tr></tr>"), o = 0; o < r; o++)(e = n()).parent = this, e.jQ = q('<td class="mq-empty">').attr(i, e.id), a.append(e.jQ), s = s || e; return a.insertAfter(t), s } }, t.addColumn = function (t) { if (!(t.closest("tr").find("td").length >= this.maximum.columns)) { var e, s = t.index(), r = (t = t.closest("tr").index(), this), a = []; return this.jQ.find("tr").each((function () { (e = n()).parent = r, e.jQ = q('<td class="mq-empty">').attr(i, e.id), e.jQ.insertAfter(q(this).find("td").eq(s)), a.push(e) })), a[t] } }, t.insertColumn = function (t) { (newBlock = this.addColumn(t.jQ)) && (this.cursor = this.cursor || this.parent.cursor, this.finalizeTree(), this.bubble("redraw").cursor.insAtRightEnd(newBlock)) }, t.insertRow = function (t) { (newBlock = this.addRow(t.jQ.closest("tr"))) && (this.cursor = this.cursor || this.parent.cursor, this.finalizeTree(), this.bubble("redraw").cursor.insAtRightEnd(newBlock), this.bubble("edited")) }, t.backspace = function (t, e, n, i) { t.isEmpty() && ((t = this.deleteCell(t)) ? n.insAtRightEnd(t) : (i(), this.finalizeTree()), this.bubble("edited")) } })), qt = m(et, (function (t, e) { t.init = function (t, e) { e = '<span class="mq-non-leaf" style="position: relative;"><span class="integral-fix"><span class="integral-fix" style="position: absolute; top: -6px; left: 24px;"><small>&1</small></span></span>' + e + '<span class="integral-fix"><span class="integral-fix" style = "position: absolute; bottom:-2px; left: 13px"><small>&0</small></span></span></span>', nt.prototype.init.call(this, t, e) }, t.latex = function () { function t(t) { return 1 === t.length ? t : "{" + (t || "") + "}" } return this.ctrlSeq + "_" + t(this.ends[w].latex()) + "^" + t(this.ends[1].latex()) }, t.parser = function () { for (var t = P.string, e = P.optWhitespace, n = P.succeed, i = V.block, s = this, r = s.blocks = [rt(), rt()], a = 0; a < r.length; a += 1)r[a].adopt(s, s.ends[1], 0); return e.then(t("_").or(t("^"))).then((function (t) { var e = r["_" === t ? 0 : 1]; return i.then((function (t) { return t.children().adopt(e, e.ends[1], 0), n(s) })) })).many().result(s) }, t.finalizeTree = function () { this.downInto = this.ends[w], this.upInto = this.ends[1], this.ends[w].upOutOf = this.ends[1], this.ends[1].downOutOf = this.ends[w] } })), tt = m(et, (function (t, e) { t.init = function (t, e) { nt.prototype.init.call(this, t, "<big>&0</big>") }, t.latex = function () { var t; return this.ctrlSeq + (1 === (t = this.ends[w].latex()).length ? t : t || "\t") }, t.parser = function () { for (var t = P.string, e = P.optWhitespace, n = P.succeed, i = V.block, s = this, r = s.blocks = [rt(), rt()], a = 0; a < r.length; a += 1)r[a].adopt(s, s.ends[1], 0); return e.then(t("_").or(t("^"))).then((function (t) { var e = r["_" === t ? 0 : 1]; return i.then((function (t) { return t.children().adopt(e, e.ends[1], 0), n(s) })) })).many().result(s) }, t.finalizeTree = function () { this.downInto = this.ends[w], this.upInto = this.ends[1], this.ends[w].upOutOf = this.ends[1], this.ends[1].downOutOf = this.ends[w] } })), m(et, (function (t, e) { t.init = function (t, e) { nt.prototype.init.call(this, t, '<span class="mq-non-leaf" style="0.2em; margin-right:0.2em;"><span class="integral-fix"><span class="integral-fix"><small>&1</small></span></span><svg style="height:1em; width:auto;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 500"><rect x="6" y="0" width="15" height="500"/></svg><span class="integral-fix"><span class="integral-fix" style = ""><small>&0</small></span></span></span>') }, t.latex = function () { function t(t) { return 1 === t.length ? t : "{" + (t || "") + "}" } return "\\rvert_" + t(this.ends[w].latex()) + "^" + t(this.ends[1].latex()) }, t.parser = function () { for (var t = P.string, e = P.optWhitespace, n = P.succeed, i = V.block, s = this, r = s.blocks = [rt(), rt()], a = 0; a < r.length; a += 1)r[a].adopt(s, s.ends[1], 0); return e.then(t("_").or(t("^"))).then((function (t) { var e = r["_" === t ? 0 : 1]; return i.then((function (t) { return t.children().adopt(e, e.ends[1], 0), n(s) })) })).many().result(s) }, t.finalizeTree = function () { this.downInto = this.ends[w], this.upInto = this.ends[1], this.ends[w].upOutOf = this.ends[1], this.ends[1].downOutOf = this.ends[w] } })), xt = m(et, (function (t, e) { t.init = function (t, e) { e = '<span class="mq-binary-operator mq-non-leaf"><span style = "margin-bottom: 0px; margin-right:0px !important; margin-bottom: -5px;">' + e + '</span><div class="mq-from" style = "margin-top: -6px !important;"><small>&0</small></div></span>', nt.prototype.init.call(this, t, e) }, t.latex = function () { var t; return this.ctrlSeq + "_" + (1 === (t = this.ends[w].latex()).length ? t : "{" + (t || " ") + "}") }, t.parser = function () { for (var t = P.string, e = P.optWhitespace, n = P.succeed, i = V.block, s = this, r = s.blocks = [rt(), rt()], a = 0; a < r.length; a += 1)r[a].adopt(s, s.ends[1], 0); return e.then(t("_").or(t("^"))).then((function (t) { var e = r["_" === t ? 0 : 1]; return i.then((function (t) { return t.children().adopt(e, e.ends[1], 0), n(s) })) })).many().result(s) }, t.finalizeTree = function () { this.downInto = this.ends[w], this.upInto = this.ends[1], this.ends[w].upOutOf = this.ends[1], this.ends[1].downOutOf = this.ends[w] } })), C[""] = C.lim = C.limit = u(xt, "\\lim ", "lim"), C[""] = C.biggr = C.biggr = u(tt, "\\biggr ", "biggr"), C[""] = C.oint = C.integral = u(qt, "\\oint ", '<svg style="height: 3em; width:auto;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 205 500"> <ellipse style="stroke: rgba(0, 0, 0, 0.19); stroke-width: 0.2px;" cx="189.794" cy="23.362" rx="11.161" ry="11.161"/> <path style="stroke-width: 0.2px; stroke: rgba(0, 0, 0, 0);" d="M 201.025 22.786 C 201.025 22.786 201.433 23.502 200.199 17.337 C 198.965 11.171 190.815 6.182 186.682 4.558 C 182.55 2.934 174.026 0.312 164.536 7.265 C 155.047 14.219 145.475 38.671 145.624 38.641 C 145.023 38.46 135.091 70.272 121.113 129.443 C 107.136 188.615 93.458 256.025 93.679 256.025 C 93.679 256.025 95.229 247.403 88.396 283.589 C 81.563 319.774 79.792 331.922 68.911 392.654 C 58.03 453.385 46.075 491.571 29.14 493.426 C 12.206 495.281 3.438 474.209 3.438 474.209 L 2.327 473.612 C 2.327 473.612 -1.426 487.946 15.809 495.455 C 33.044 502.964 45.246 490.933 48.402 488.8 C 51.558 486.667 66.504 470.384 79.461 420.066 C 92.418 369.748 99.625 337.591 99.625 337.591 C 99.625 337.591 109.043 301.616 120.202 240.329 C 131.361 179.041 140.13 127.49 149.882 78.211 C 159.634 28.931 168.994 13.12 170.662 11.784 C 172.331 10.449 172.998 7.448 178.447 7.336 C 183.896 7.224 190.902 12.563 190.902 12.563 L 201.025 22.786 Z"/> <ellipse style="stroke: rgba(0, 0, 0, 0);" cx="12.981" cy="477.361" rx="11.295" ry="11.295"/> <ellipse style="fill: rgba(216, 216, 216, 0); stroke: rgb(0, 0, 0); stroke-width: 6px;" cx="108.513" cy="245.874" rx="56.564" ry="56.564"/> </svg>'), C[""] = C.int = C.integral = u(qt, "\\int ", '<svg style="height: 3em; width:auto;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 205 500"> <ellipse style="stroke: rgba(0, 0, 0, 0.19); stroke-width: 0.2px;" cx="189.794" cy="23.362" rx="11.161" ry="11.161"/> <path style="stroke-width: 0.2px; stroke: rgba(0, 0, 0, 0);" d="M 201.025 22.786 C 201.025 22.786 201.433 23.502 200.199 17.337 C 198.965 11.171 190.815 6.182 186.682 4.558 C 182.55 2.934 174.026 0.312 164.536 7.265 C 155.047 14.219 145.475 38.671 145.624 38.641 C 145.023 38.46 135.091 70.272 121.113 129.443 C 107.136 188.615 93.458 256.025 93.679 256.025 C 93.679 256.025 95.229 247.403 88.396 283.589 C 81.563 319.774 79.792 331.922 68.911 392.654 C 58.03 453.385 46.075 491.571 29.14 493.426 C 12.206 495.281 3.438 474.209 3.438 474.209 L 2.327 473.612 C 2.327 473.612 -1.426 487.946 15.809 495.455 C 33.044 502.964 45.246 490.933 48.402 488.8 C 51.558 486.667 66.504 470.384 79.461 420.066 C 92.418 369.748 99.625 337.591 99.625 337.591 C 99.625 337.591 109.043 301.616 120.202 240.329 C 131.361 179.041 140.13 127.49 149.882 78.211 C 159.634 28.931 168.994 13.12 170.662 11.784 C 172.331 10.449 172.998 7.448 178.447 7.336 C 183.896 7.224 190.902 12.563 190.902 12.563 L 201.025 22.786 Z"/> <ellipse style="stroke: rgba(0, 0, 0, 0);" cx="12.981" cy="477.361" rx="11.295" ry="11.295"/> </svg>'), C["∑"] = C.sum = C.summation = u(Dt, "\\sum ", '<svg viewBox="1.002 0.505 118.375 120.422" width="118.375" height="120.422"> <path style="stroke: rgb(0, 0, 0);" d="M 15.734 114.783 L 87.838 114.783 C 107.703 114.374 118.558 95.122 118.558 95.122 C 118.558 95.122 109.342 120.313 109.342 120.927 L 4.713 120.927 L 50.359 66.45 L 1.002 0.505 L 109.814 0.505 L 119.377 23.442 C 119.377 23.442 112.004 3.577 67.153 4.396 L 18.542 4.396 C 18.542 4.396 60.19 60.921 60.395 60.921 C 60.6 60.921 15.543 114.783 15.543 114.783"> </path> </svg>'), C["∏"] = C.prod = C.product = u(Dt, "\\prod ", "&prod;"), C.coprod = C.coproduct = u(Dt, "\\coprod ", "&#8720;"); qt = C.frac = C.dfrac = C.cfrac = C.fraction = m(et, (function (t, e) { t.ctrlSeq = "\\frac", t.htmlTemplate = '<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>', t.textTemplate = ["(", ")/(", ")"], t.finalizeTree = function () { this.upInto = this.ends[1].upOutOf = this.ends[w], this.downInto = this.ends[w].downOutOf = this.ends[1] } })); var Lt = C.over = T["/"] = m(qt, (function (t, e) { t.createLeftOf = function (t) { if (!this.replacedFragment) { for (var n = t[w]; n && !(n instanceof st || n instanceof (C.text || a) || n instanceof Dt || "\\ " === n.ctrlSeq || /^[,;:]$/.test(n.ctrlSeq));)n = n[w]; n instanceof Dt && n[1] instanceof _t && (n = n[1])[1] instanceof _t && n[1].ctrlSeq != n.ctrlSeq && (n = n[1]), n !== t[w] && (this.replaces(j(n[1] || t.parent.ends[w], t[w])), t[w] = n) } e.createLeftOf.call(this, t) } })), Et = (qt = C.sqrt = C["√"] = m(et, (function (t, e) { t.ctrlSeq = "\\sqrt", t.htmlTemplate = '<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>', t.textTemplate = ["sqrt(", ")"], t.parser = function () { return V.optBlock.then((function (t) { return V.block.map((function (e) { var n = Et(); return n.blocks = [t, e], t.adopt(n, 0, 0), e.adopt(n, t, 0), n })) })).or(e.parser.call(this)) }, t.reflow = function () { var t = this.ends[1].jQ; kt(t.prev(), 1, t.innerHeight() / +t.css("fontSize").slice(0, -2) - .1) } })), C.vec = m(et, (function (t, e) { t.ctrlSeq = "\\vec", t.htmlTemplate = '<span class="mq-non-leaf"><span class="mq-vector-prefix">&rarr;</span><span class="mq-vector-stem">&0</span></span>', t.textTemplate = ["vec(", ")"] })), C.nthroot = m(qt, (function (t, e) { t.htmlTemplate = '<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>', t.textTemplate = ["sqrt[", "](", ")"], t.latex = function () { return "\\sqrt[" + this.ends[w].latex() + "]{" + this.ends[1].latex() + "}" } }))); function At(t, e) { t.jQadd = function () { e.jQadd.apply(this, arguments), this.delimjQs = this.jQ.children(":first").add(this.jQ.children(":last")), this.contentjQ = this.jQ.children(":eq(1)") }, t.reflow = function () { var t = this.contentjQ.outerHeight() / parseFloat(this.contentjQ.css("fontSize")); kt(this.delimjQs, s(1 + .2 * (t - 1), 1.2), 1.2 * t) } } C.hat = m(qt, (function (t, e) { t.htmlTemplate = '<span class="mq-non-leaf"><span class="mq-vector-prefix"><svg viewBox="0 0.5 300 100" style="width="auto"; height="0.2em"; line-height: ;> <path style="stroke: rgba(0, 0, 0, 0);" d="M 0 135 L 145 0.6 L 300 127.516 L 145 30 L 0 135 Z"></path> </svg></span><span class="mq-vector-stem" style="margin-top:-2px">&0</span></span>', t.textTemplate = ["hat(", ")"], t.latex = function () { return "\\hat{" + this.ends[1].latex() + "}" } })); var Rt = m(m(et, At), (function (e, n) { e.init = function (e, i, s, r, a) { n.init.call(this, "\\left" + r, t, [i, s]), this.side = e, this.sides = {}, this.sides[w] = { ch: i, ctrlSeq: r }, this.sides[1] = { ch: s, ctrlSeq: a } }, e.numBlocks = function () { return 1 }, e.html = function () { return this.htmlTemplate = '<span class="mq-non-leaf"><span class="mq-scaled mq-paren' + (1 === this.side ? " mq-ghost" : "") + '">' + this.sides[w].ch + '</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren' + (this.side === w ? " mq-ghost" : "") + '">' + this.sides[1].ch + "</span></span>", n.html.call(this) }, e.latex = function () { return "\\left" + this.sides[w].ctrlSeq + this.ends[w].latex() + "\\right" + this.sides[1].ctrlSeq }, e.oppBrack = function (t, e, n) { return e instanceof Rt && e.side && e.side !== -n && ("|" === this.sides[this.side].ch || e.side === -this.side) && (!t.restrictMismatchedBrackets || It[this.sides[this.side].ch] === e.sides[e.side].ch || { "(": "]", "[": ")" }[this.sides[w].ch] === e.sides[1].ch) && e }, e.closeOpposing = function (t) { t.side = 0, t.sides[this.side] = this.sides[this.side], t.delimjQs.eq(this.side === w ? 0 : 1).removeClass("mq-ghost").html(this.sides[this.side].ch) }, e.createLeftOf = function (t) { var e, i; this.replacedFragment || (e = t.options, e = this.oppBrack(e, t[w], w) || this.oppBrack(e, t[1], 1) || this.oppBrack(e, t.parent.parent)), e ? (i = this.side = -e.side, this.closeOpposing(e), e === t.parent.parent && t[i] && (j(t[i], t.parent.ends[i], -i).disown().withDirAdopt(-i, e.parent, e, e[i]).jQ.insDirOf(i, e.jQ), e.bubble("reflow"))) : (i = (e = this).side, e.replacedFragment ? e.side = 0 : t[-i] && (e.replaces(j(t[-i], t.parent.ends[-i], i)), t[-i] = 0), n.createLeftOf.call(e, t)), i === w ? t.insAtLeftEnd(e.ends[w]) : t.insRightOf(e) }, e.placeCursor = a, e.unwrap = function () { this.ends[w].children().disown().adopt(this.parent, this, this[1]).jQ.insertAfter(this.jQ), this.remove() }, e.deleteSide = function (t, e, n) { var i = this.parent, s = this[t], r = i.ends[t]; if (t === this.side) return this.unwrap(), void (s ? n.insDirOf(-t, s) : n.insAtDirEnd(t, i)); var a = n.options, o = !this.side; if (this.side = -t, this.oppBrack(a, this.ends[w].ends[this.side], t)) { this.closeOpposing(this.ends[w].ends[this.side]); var l = this.ends[w].ends[t]; this.unwrap(), l.siblingCreated && l.siblingCreated(n.options, t), s ? n.insDirOf(-t, s) : n.insAtDirEnd(t, i) } else { if (this.oppBrack(a, this.parent.parent, t)) this.parent.parent.closeOpposing(this), this.parent.parent.unwrap(); else { if (e && o) return this.unwrap(), void (s ? n.insDirOf(-t, s) : n.insAtDirEnd(t, i)); this.sides[t] = { ch: It[this.sides[this.side].ch], ctrlSeq: It[this.sides[this.side].ctrlSeq] }, this.delimjQs.removeClass("mq-ghost").eq(t === w ? 0 : 1).addClass("mq-ghost").html(this.sides[t].ch) } s ? (l = this.ends[w].ends[t], j(s, r, -t).disown().withDirAdopt(-t, this.ends[w], l, 0).jQ.insAtDirEnd(t, this.ends[w].jQ.removeClass("mq-empty")), l.siblingCreated && l.siblingCreated(n.options, t), n.insDirOf(-t, s)) : e ? n.insDirOf(t, this) : n.insAtDirEnd(t, this.ends[w]) } }, e.deleteTowards = function (t, e) { this.deleteSide(-t, !1, e) }, e.finalizeTree = function () { this.ends[w].deleteOutOf = function (t, e) { this.parent.deleteSide(t, !0, e) }, this.finalizeTree = this.intentionalBlur = function () { this.delimjQs.eq(this.side === w ? 1 : 0).removeClass("mq-ghost"), this.side = 0 } }, e.siblingCreated = function (t, e) { e === -this.side && this.finalizeTree() } })), It = { "(": ")", ")": "(", "[": "]", "]": "[", "{": "}", "}": "{", "\\{": "\\}", "\\}": "\\{", "&lang;": "&rang;", "&rang;": "&lang;", "\\langle ": "\\rangle ", "\\rangle ": "\\langle ", "|": "|" }; function zt(t, e) { e = e || t; var n = It[t], i = It[e]; T[t] = u(Rt, w, t, n, e, i), T[n] = u(Rt, 1, t, n, e, i) } zt("("), zt("["), zt("{", "\\{"), C.langle = u(Rt, w, "&lang;", "&rang;", "\\langle ", "\\rangle "), C.rangle = u(Rt, 1, "&lang;", "&rang;", "\\langle ", "\\rangle "), T["|"] = u(Rt, w, "|", "|", "|", "|"), C.left = m(et, (function (t) { t.parser = function () { var t = P.regex, e = P.string, n = (P.succeed, P.optWhitespace); return n.then(t(/^(?:[([|]|\\\{)/)).then((function (i) { var s = "\\" === i.charAt(0) ? i.slice(1) : i; return V.then((function (r) { return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\})/)).map((function (t) { var e = "\\" === t.charAt(0) ? t.slice(1) : t; return (t = Rt(0, s, e, i, t)).blocks = [r], r.adopt(t, 0, 0), t })) })) })) } })), C.right = m(et, (function (t) { t.parser = function () { return P.fail("unmatched \\right") } })), qt = C.binom = C.binomial = m(m(et, At), (function (t, e) { t.ctrlSeq = "\\binom", t.htmlTemplate = '<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>', t.textTemplate = ["choose(", ",", ")"] })), C.choose = m(qt, (function (t) { t.createLeftOf = Lt.prototype.createLeftOf })), C.editable = C.MathQuillMathField = m(et, (function (t, e) { t.ctrlSeq = "\\MathQuillMathField", t.htmlTemplate = '<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>', t.parser = function () { var t = this, n = P.string, i = P.regex, s = P.succeed; return n("[").then(i(/^[a-z][a-z0-9]*/i)).skip(n("]")).map((function (e) { t.name = e })).or(s()).then(e.parser.call(t)) }, t.finalizeTree = function () { var t = S(this.ends[w], this.jQ, L()); t.KIND_OF_MQ = "MathField", t.editable = !0, t.createTextarea(), t.editablesTextareaEvents(), t.cursor.insAtRightEnd(t.root), $(t.root) }, t.registerInnerField = function (t, e) { t.push(t[this.name] = e(this.ends[w].controller)) }, t.latex = function () { return this.ends[w].latex() }, t.text = function () { return this.ends[w].text() } })); var Bt, Mt = C.embed = m(nt, (function (t, e) { t.setOptions = function (t) { function e() { return "" } return this.text = t.text || e, this.htmlTemplate = t.htmlString || "", this.latex = t.latex || e, this }, t.parser = function () { var t = this; return string = P.string, regex = P.regex, succeed = P.succeed, string("{").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("}")).then((function (e) { return string("[").then(regex(/^[-\w\s]*/)).skip(string("]")).or(succeed()).map((function (n) { return t.setOptions(R[e](n)) })) })) } })), Ft = F(1); for (Bt in Ft) !function (t, e) { "function" == typeof e ? (z[t] = function () { return I(), e.apply(this, arguments) }).prototype = e.prototype : z[t] = e }(Bt, Ft[Bt]) }();